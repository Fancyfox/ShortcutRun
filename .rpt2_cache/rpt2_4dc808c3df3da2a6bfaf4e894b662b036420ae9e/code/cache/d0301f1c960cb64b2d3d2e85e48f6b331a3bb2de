{
  "code": "import EventManager from \"../script/Singleton/EventManager\";\r\nimport GameDefine, { CharacterAnimation, EventName, GameState } from \"../script/Singleton/GameDefine\";\r\nimport Camera from \"./Camera\";\r\nimport Obj from \"./Obj\";\r\nexport default class Player extends Obj {\r\n    constructor() {\r\n        super();\r\n        this._rotate_speed = 0.35;\r\n        this.fingerMoveDistance_x = 0;\r\n        this.isMouseDown = false;\r\n        this._isRayCast = false;\r\n    }\r\n    onAwake() {\r\n        super.onAwake();\r\n        this._player = this.owner;\r\n        this._point = this._player.getChildByName(\"point\");\r\n        this._animator = this._player.getComponent(Laya.Animator);\r\n        console.log(this._animator, \"animatro\");\r\n        this._playerMove = new Laya.Vector3(0, 0, 0.15);\r\n        this.curFrameTouchPoint_x = 0;\r\n        this.lastFrameTouchPoint_x = 0;\r\n        this._playerRotate = new Laya.Vector3(0, this._rotate_speed, 0);\r\n        Laya.stage.on(Laya.Event.MOUSE_DOWN, this, this.mouseDown);\r\n        Laya.stage.on(Laya.Event.MOUSE_MOVE, this, this.mouseMove);\r\n        Laya.stage.on(Laya.Event.MOUSE_UP, this, this.mouseUp);\r\n    }\r\n    onStart() {\r\n        this.initRay();\r\n    }\r\n    onEnable() {\r\n        EventManager.register(EventName.MINI_GAME_START, this._onGameStart, this);\r\n    }\r\n    onDisable() {\r\n        EventManager.unRegister(EventName.MINI_GAME_START, this._onGameStart, this);\r\n    }\r\n    initScene3d(scene) {\r\n        this._physicsSimulation = scene.physicsSimulation;\r\n    }\r\n    mouseDown() {\r\n        console.log(\"down\");\r\n        if (GameDefine.gameState != GameState.Playing) {\r\n            return;\r\n        }\r\n        if (this.isMouseDown) {\r\n            return;\r\n        }\r\n        this.isMouseDown = true;\r\n        this.curFrameTouchPoint_x = Laya.MouseManager.instance.mouseX;\r\n        this.lastFrameTouchPoint_x = Laya.MouseManager.instance.mouseX;\r\n    }\r\n    mouseMove() {\r\n        if (GameDefine.gameState != GameState.Playing) {\r\n            return;\r\n        }\r\n        if (!this.isMouseDown) {\r\n            return;\r\n        }\r\n        this.curFrameTouchPoint_x = Laya.MouseManager.instance.mouseX;\r\n        this.fingerMoveDistance_x = this.curFrameTouchPoint_x - this.lastFrameTouchPoint_x;\r\n        if (this.fingerMoveDistance_x > 0) {\r\n            this._playerRotate.setValue(0, -this._rotate_speed * Laya.timer.delta / 1000 * this.fingerMoveDistance_x, 0);\r\n            this._player.transform.rotate(this._playerRotate, true);\r\n        }\r\n        else if (this.fingerMoveDistance_x < 0) {\r\n            this._playerRotate.setValue(0, -this._rotate_speed * Laya.timer.delta / 1000 * this.fingerMoveDistance_x, 0);\r\n            this._player.transform.rotate(this._playerRotate, true);\r\n        }\r\n        this.lastFrameTouchPoint_x = this.curFrameTouchPoint_x;\r\n    }\r\n    mouseUp() {\r\n        if (GameDefine.gameState != GameState.Playing) {\r\n            return;\r\n        }\r\n        if (this.isMouseDown) {\r\n            this.isMouseDown = false;\r\n        }\r\n    }\r\n    onUpdate() {\r\n        if (Laya.timer.delta > 100) {\r\n            return;\r\n        }\r\n        if (GameDefine.gameState != GameState.Playing) {\r\n            return;\r\n        }\r\n        this._moveForward();\r\n        this.rayCast();\r\n    }\r\n    init(data) {\r\n        super.init(data);\r\n        Camera.instance.initPlayerData(this._player, this._point);\r\n        console.log(\"player init\");\r\n        this._playAnimation(CharacterAnimation.Idel);\r\n    }\r\n    initCamera(camera) {\r\n        this._camera = camera;\r\n        this._player = this.owner;\r\n        this._player.addChild(camera);\r\n        let point = this._player.getChildByName(\"point\");\r\n        this._camera.transform.position = point.transform.position;\r\n        this._camera.transform.lookAt(this._player.transform.position, Laya.Vector3.up);\r\n    }\r\n    _moveForward() {\r\n        this._player.transform.translate(this._playerMove, true);\r\n    }\r\n    _playAnimation(state) {\r\n        this._animator.play(state);\r\n    }\r\n    _onGameStart() {\r\n        this._playAnimation(CharacterAnimation.Running);\r\n        this.startRay();\r\n    }\r\n    initRay() {\r\n        this._ray_orign = this._player.transform.position;\r\n        this._ray_down = new Laya.Ray(this._ray_orign, Laya.Vector3.down);\r\n        this._outInfo = new Laya.HitResult();\r\n    }\r\n    startRay() {\r\n        this._isRayCast = true;\r\n    }\r\n    rayCast() {\r\n        if (!this._physicsSimulation) {\r\n            return;\r\n        }\r\n        if (!this._isRayCast) {\r\n            return;\r\n        }\r\n        let pos = this._player.transform.position;\r\n        this._ray_orign.setValue(pos.x, pos.y + 2, pos.z);\r\n        if (this._physicsSimulation.rayCast(this._ray_down, this._outInfo, 5)) {\r\n            console.log(\"射线检测到了\", this._outInfo.collider.owner.name);\r\n        }\r\n    }\r\n}\r\n",
  "references": [
    "D:/WorkSpace/Laya2.6.1/ShortcutRun/src/script/Extensions/Vector3.ts",
    "D:/WorkSpace/Laya2.6.1/ShortcutRun/src/script/Singleton/EventManager.ts",
    "D:/WorkSpace/Laya2.6.1/ShortcutRun/src/script/Singleton/GameDefine.ts",
    "D:/WorkSpace/Laya2.6.1/ShortcutRun/src/Entity/Camera.ts",
    "D:/WorkSpace/Laya2.6.1/ShortcutRun/src/Entity/Obj.ts"
  ]
}
