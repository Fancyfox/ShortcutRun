{
  "code": "import { CharactorManager } from \"../../Data/CharactorManager\";\r\nimport { Constants } from \"../../Data/Constants\";\r\nimport { MiniGameManager } from \"../../Data/MiniGameManager\";\r\nimport { SdkUitl } from \"../../Util/SdkUitl\";\r\nimport GamePage from \"../Pages/GamePage\";\r\nimport AudioManager from \"../Singleton/AudioManager\";\r\nimport ES from \"../Singleton/ES\";\r\nimport EventManager from \"../Singleton/EventManager\";\r\nimport GameData from \"../Singleton/GameData\";\r\nimport { EventName } from \"../Singleton/GameDefine\";\r\nimport GameManager from \"../Singleton/GameManager\";\r\nimport GameRecorderManager from \"../Singleton/GameRecorderManager\";\r\nimport RankItem from \"./Compoments/RankItem\";\r\nimport { PanelBase } from \"./PanelBase\";\r\nexport default class Result extends PanelBase {\r\n    constructor() {\r\n        super();\r\n        this.onShowEnd = this.setRankItem;\r\n        Result.instance = this;\r\n    }\r\n    onAwake() {\r\n        this._result = this.owner;\r\n        this._uiBox = this._result.getChildAt(0);\r\n        this._videoBtn = this._uiBox.getChildByName(\"VideoBtn\");\r\n        this._shareBtn = this._uiBox.getChildByName(\"ShareBtn\");\r\n        this._directBtn = this._uiBox.getChildByName(\"DirectBtn\");\r\n        this._recordBtn = this._uiBox.getChildByName(\"RecordBtn\");\r\n        this._recordLabel = this._recordBtn.getChildByName(\"RecordLabel\");\r\n        this._ranks = this._uiBox.getChildByName(\"Ranks\");\r\n        this._youRankLabel = this._uiBox.getChildByName(\"RankBack\").getChildByName(\"YouRankBack\");\r\n        this._videoBtn.on(Laya.Event.CLICK, this, this.getVideoReward);\r\n        this._shareBtn.on(Laya.Event.CLICK, this, this.getRewardByShare);\r\n        this._directBtn.on(Laya.Event.CLICK, this, this.getDirectReward);\r\n        this._recordBtn.on(Laya.Event.CLICK, this, this.shareRecord);\r\n    }\r\n    onStart() {\r\n    }\r\n    show() {\r\n        super.show();\r\n        this._refreshYouRankLabel();\r\n        SdkUitl.showBanner();\r\n        SdkUitl.stopGameRecord();\r\n        if (Laya.Browser.window.tt) {\r\n            this._shareBtn.visible = false;\r\n            this._recordBtn.visible = true;\r\n            if (GameRecorderManager.instance().canShowReward()) {\r\n                this._recordLabel.text = \"三倍领取\";\r\n                this._recordBtn.centerX = -185;\r\n                this._recordBtn.centerY = 300;\r\n                this._recordBtn.scale(1, 1);\r\n                this._videoBtn.visible = false;\r\n            }\r\n            else {\r\n                this._recordLabel.text = \"分享录屏\";\r\n                this._recordBtn.centerX = 0;\r\n                this._recordBtn.centerY = 150;\r\n                this._recordBtn.scale(0.8, 0.8);\r\n                this._videoBtn.visible = true;\r\n            }\r\n        }\r\n        else {\r\n            this._videoBtn.visible = true;\r\n            this._shareBtn.visible = false;\r\n            this._recordBtn.visible = false;\r\n        }\r\n        if (MiniGameManager.instance().getSceneLevel() % 3 == 0) {\r\n            SdkUitl.showInterstitialAd();\r\n        }\r\n    }\r\n    hide() {\r\n        super.hide();\r\n        SdkUitl.hideBanner();\r\n    }\r\n    shareRecord() {\r\n        if (!SdkUitl.canReleaseGameRecord()) {\r\n            return;\r\n        }\r\n        if (GameRecorderManager.instance().canShowReward()) {\r\n            SdkUitl.releaseGameRecord(() => {\r\n                let startPos = new Laya.Vector2(this._recordBtn.x, this._recordBtn.y);\r\n                GamePage.instance.showPage(Constants.UIPage.coinEffect, null, startPos, () => {\r\n                    EventManager.dispatchEvent(EventName.ADD_MOENY);\r\n                }, 10, GamePage.instance.getCoinPrefab());\r\n                this._getReward(3);\r\n                this.nextLevel();\r\n                this._recordBtn.visible = false;\r\n                SdkUitl.ShowToast(\"录屏分享成功，获得三倍奖励~\");\r\n            }, () => {\r\n                SdkUitl.ShowToast(\"录屏分享失败\");\r\n            });\r\n        }\r\n        else {\r\n            SdkUitl.releaseGameRecord(() => {\r\n                SdkUitl.ShowToast(\"录屏分享成功~\");\r\n            }, () => {\r\n                SdkUitl.ShowToast(\"录屏分享失败\");\r\n            });\r\n        }\r\n    }\r\n    getVideoReward() {\r\n        AudioManager.instance().playEffect(\"Click\");\r\n        SdkUitl.showVideoRewardAd(() => {\r\n            SdkUitl.ShowToast(\"恭喜获得三倍奖励~\");\r\n            let startPos = new Laya.Vector2(this._videoBtn.x, this._videoBtn.y);\r\n            GamePage.instance.showPage(Constants.UIPage.coinEffect, null, startPos, () => {\r\n                EventManager.dispatchEvent(EventName.ADD_MOENY);\r\n            }, 10, GamePage.instance.getCoinPrefab());\r\n            this._getReward(3);\r\n            this.nextLevel();\r\n        }, () => {\r\n            SdkUitl.ShowToast(\"只有观看完毕才可获取奖励哦~\");\r\n        });\r\n    }\r\n    getDirectReward() {\r\n        AudioManager.instance().playEffect(\"Click\");\r\n        let startPos = new Laya.Vector2(this._directBtn.x, this._directBtn.y);\r\n        GamePage.instance.showPage(Constants.UIPage.coinEffect, null, startPos, () => {\r\n            EventManager.dispatchEvent(EventName.ADD_MOENY);\r\n        }, 10, GamePage.instance.getCoinPrefab());\r\n        this._getReward();\r\n        this.nextLevel();\r\n    }\r\n    nextLevel() {\r\n        MiniGameManager.instance().nextLevel();\r\n        let level = Math.floor(MiniGameManager.instance().getSceneLevel() / 3) + 1;\r\n        level = level % 7 == 0 ? 1 : level % 7;\r\n        GamePage.instance.hidePage(Constants.UIPage.result, () => {\r\n            ES.instance.event(ES.on_clear_scene);\r\n            GamePage.instance.showPage(Constants.UIPage.loading);\r\n            GameManager.instance().loadLevel(level).then(() => {\r\n                GamePage.instance.hidePage(Constants.UIPage.loading, () => {\r\n                    GamePage.instance.showPage(Constants.UIPage.home);\r\n                    GamePage.instance.showPage(Constants.UIPage.info, null, true, true, true);\r\n                });\r\n            });\r\n        });\r\n    }\r\n    setRankItem() {\r\n        for (let i = 0; i < this._ranks.numChildren; i++) {\r\n            let playerData;\r\n            GameData.playerInfos.map(data => {\r\n                if (data.rank - 1 == i) {\r\n                    playerData = data;\r\n                }\r\n            });\r\n            const comp = this._ranks.getChildAt(i).getComponent(RankItem);\r\n            comp.setData && comp.setData(playerData);\r\n        }\r\n    }\r\n    _getReward(rate = 1) {\r\n        let rewardCoin = GameData.rewardCoin * rate;\r\n        CharactorManager.instance().addMoney(rewardCoin, true);\r\n    }\r\n    _refreshYouRankLabel() {\r\n        let rank = GameData.playRank;\r\n        switch (rank) {\r\n            case 1:\r\n                this._youRankLabel.text = \"第一名\";\r\n                break;\r\n            case 2:\r\n                this._youRankLabel.text = \"第二名\";\r\n                break;\r\n            case 3:\r\n                this._youRankLabel.text = \"第三名\";\r\n                break;\r\n            case 4:\r\n                this._youRankLabel.text = \"第四名\";\r\n                break;\r\n        }\r\n    }\r\n    getRewardByShare() {\r\n        AudioManager.instance().playEffect(\"Click\");\r\n        SdkUitl.share(false, () => {\r\n            SdkUitl.ShowToast(\"分享成功，获得三倍金币奖励！！！\");\r\n            this._getReward(3);\r\n            this.nextLevel();\r\n        }, () => {\r\n            SdkUitl.ShowToast(\"分享失败，请分享到不同的群~\");\r\n        });\r\n    }\r\n}\r\nResult.instance = null;\r\n",
  "references": [
    "D:/WorkSpace/Laya2.6.1/ShortcutRun/src/Data/CharactorManager.ts",
    "D:/WorkSpace/Laya2.6.1/ShortcutRun/src/Data/Constants.ts",
    "D:/WorkSpace/Laya2.6.1/ShortcutRun/src/Data/MiniGameManager.ts",
    "D:/WorkSpace/Laya2.6.1/ShortcutRun/src/Util/SdkUitl.ts",
    "D:/WorkSpace/Laya2.6.1/ShortcutRun/src/script/Pages/GamePage.ts",
    "D:/WorkSpace/Laya2.6.1/ShortcutRun/src/script/Singleton/AudioManager.ts",
    "D:/WorkSpace/Laya2.6.1/ShortcutRun/src/script/Singleton/ES.ts",
    "D:/WorkSpace/Laya2.6.1/ShortcutRun/src/script/Singleton/EventManager.ts",
    "D:/WorkSpace/Laya2.6.1/ShortcutRun/src/script/Singleton/GameData.ts",
    "D:/WorkSpace/Laya2.6.1/ShortcutRun/src/script/Singleton/GameDefine.ts",
    "D:/WorkSpace/Laya2.6.1/ShortcutRun/src/script/Singleton/GameManager.ts",
    "D:/WorkSpace/Laya2.6.1/ShortcutRun/src/script/Singleton/GameRecorderManager.ts",
    "D:/WorkSpace/Laya2.6.1/ShortcutRun/src/script/UI/Compoments/RankItem.ts",
    "D:/WorkSpace/Laya2.6.1/ShortcutRun/src/script/UI/PanelBase.ts"
  ]
}
