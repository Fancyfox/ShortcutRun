{
  "code": "import { CharactorManager } from \"../../Data/CharactorManager\";\r\nimport { Constants } from \"../../Data/Constants\";\r\nimport GamePage from \"../Pages/GamePage\";\r\nimport ES from \"../Singleton/ES\";\r\nimport GameData from \"../Singleton/GameData\";\r\nimport GameDefine from \"../Singleton/GameDefine\";\r\nimport GameManager from \"../Singleton/GameManager\";\r\nimport RankItem from \"./Compoments/RankItem\";\r\nimport { PanelBase } from \"./PanelBase\";\r\nexport default class Result extends PanelBase {\r\n    constructor() {\r\n        super();\r\n        this.onShowEnd = this.setRankItem;\r\n        Result.instance = this;\r\n    }\r\n    onAwake() {\r\n        this._result = this.owner;\r\n        this._uiBox = this._result.getChildAt(0);\r\n        this._videoBtn = this._uiBox.getChildByName(\"VideoBtn\");\r\n        this._directBtn = this._uiBox.getChildByName(\"DirectBtn\");\r\n        this._ranks = this._uiBox.getChildByName(\"Ranks\");\r\n        this._youRankLabel = this._uiBox.getChildByName(\"RankBack\").getChildByName(\"YouRankBack\");\r\n    }\r\n    onStart() {\r\n        this._videoBtn.on(Laya.Event.CLICK, this, this.getVideoReward);\r\n        this._directBtn.on(Laya.Event.CLICK, this, this.getDirectReward);\r\n    }\r\n    show() {\r\n        super.show();\r\n        this._refreshYouRankLabel();\r\n    }\r\n    hide() {\r\n        super.hide();\r\n    }\r\n    getVideoReward() {\r\n        this._getReward(3);\r\n        this.nextLevel();\r\n    }\r\n    getDirectReward() {\r\n        this._getReward();\r\n        this.nextLevel();\r\n    }\r\n    nextLevel() {\r\n        GameData.level++;\r\n        if (GameData.level > GameDefine.maxLevel) {\r\n            GameData.level = 1;\r\n        }\r\n        GamePage.instance.hidePage(Constants.UIPage.result, () => {\r\n            ES.instance.event(ES.on_clear_scene);\r\n            GamePage.instance.showPage(Constants.UIPage.loading);\r\n            GameManager.instance().loadLevel(GameData.level).then(() => {\r\n                GamePage.instance.hidePage(Constants.UIPage.loading, () => {\r\n                    GamePage.instance.showPage(Constants.UIPage.home);\r\n                });\r\n            });\r\n        });\r\n    }\r\n    setRankItem() {\r\n        console.log(GameData.playerInfos, \"GameData.playerInfos\");\r\n        for (let i = 0; i < this._ranks.numChildren; i++) {\r\n            let playerData;\r\n            GameData.playerInfos.map(data => {\r\n                if (data.rank - 1 == i) {\r\n                    playerData = data;\r\n                }\r\n            });\r\n            const comp = this._ranks.getChildAt(i).getComponent(RankItem);\r\n            comp.setData && comp.setData(playerData);\r\n        }\r\n    }\r\n    _getReward(rate = 1) {\r\n        let rewardCoin = GameData.rewardCoin * rate;\r\n        CharactorManager.instance().addMoney(rewardCoin);\r\n    }\r\n    _refreshYouRankLabel() {\r\n        let rank = GameData.playRank;\r\n        switch (rank) {\r\n            case 1:\r\n                this._youRankLabel.text = \"第一名\";\r\n                break;\r\n            case 2:\r\n                this._youRankLabel.text = \"第二名\";\r\n                break;\r\n            case 3:\r\n                this._youRankLabel.text = \"第三名\";\r\n                break;\r\n            case 4:\r\n                this._youRankLabel.text = \"第四名\";\r\n                break;\r\n        }\r\n    }\r\n}\r\nResult.instance = null;\r\n",
  "references": [
    "D:/WorkSpace/Laya2.6.1/ShortcutRun/src/Data/CharactorManager.ts",
    "D:/WorkSpace/Laya2.6.1/ShortcutRun/src/Data/Constants.ts",
    "D:/WorkSpace/Laya2.6.1/ShortcutRun/src/script/Pages/GamePage.ts",
    "D:/WorkSpace/Laya2.6.1/ShortcutRun/src/script/Singleton/ES.ts",
    "D:/WorkSpace/Laya2.6.1/ShortcutRun/src/script/Singleton/GameData.ts",
    "D:/WorkSpace/Laya2.6.1/ShortcutRun/src/script/Singleton/GameDefine.ts",
    "D:/WorkSpace/Laya2.6.1/ShortcutRun/src/script/Singleton/GameManager.ts",
    "D:/WorkSpace/Laya2.6.1/ShortcutRun/src/script/UI/Compoments/RankItem.ts",
    "D:/WorkSpace/Laya2.6.1/ShortcutRun/src/script/UI/PanelBase.ts"
  ]
}
