{
  "code": "import { Constants } from \"../../Data/Constants\";\r\nimport { MiniGameManager } from \"../../Data/MiniGameManager\";\r\nimport { SdkUitl } from \"../../Util/SdkUitl\";\r\nimport AudioManager from \"../Singleton/AudioManager\";\r\nimport GameManager from \"../Singleton/GameManager\";\r\nimport { ShopManager } from \"../Singleton/ShopManager\";\r\nimport { PanelBase, UITYpes } from \"../UI/PanelBase\";\r\nexport default class GamePage extends Laya.Script {\r\n    constructor() {\r\n        super();\r\n        this.dictPanelMap = new Map();\r\n        GamePage.instance = this;\r\n    }\r\n    onAwake() {\r\n        AudioManager.instance().loadFromCache();\r\n        ShopManager.instance().loadFromCache();\r\n        this._panelLayer = this.owner.getChildByName(\"PanelLayer\");\r\n        this._popupLayer = this.owner.getChildByName(\"PopupLayer\");\r\n        this._tipLayer = this.owner.getChildByName(\"TipLayer\");\r\n        this._effectLayer = this.owner.getChildByName(\"EffectLayer\");\r\n    }\r\n    onStart() {\r\n        let level = Math.floor(MiniGameManager.instance().getSceneLevel() / 3) + 1;\r\n        level = level % 6 == 0 ? 1 : level % 6;\r\n        this.showPage(Constants.UIPage.loading);\r\n        GameManager.instance().loadLevel(level).then(() => {\r\n            this.hidePage(Constants.UIPage.loading, () => {\r\n                this.showPage(Constants.UIPage.home, null);\r\n                this.showPage(Constants.UIPage.info, null, true, true);\r\n                SdkUitl.loadVideoRewardAd();\r\n            });\r\n        });\r\n    }\r\n    hidePage(name, cb) {\r\n        if (this.dictPanelMap.has(name)) {\r\n            const panel = this.dictPanelMap.get(name);\r\n            if (panel.parent && panel.parent.active) {\r\n                panel.parent.active = false;\r\n            }\r\n            panel.removeSelf();\r\n            const comp = panel.getComponent(PanelBase);\r\n            if (comp && comp['hide']) {\r\n                comp['hide'].apply(comp);\r\n            }\r\n            if (cb) {\r\n                cb();\r\n            }\r\n        }\r\n    }\r\n    showPage(name, cb, ...args) {\r\n        if (this.dictPanelMap.has(name)) {\r\n            const panel = this.dictPanelMap.get(name);\r\n            const comp = panel.getComponent(PanelBase);\r\n            const parent = this.getParent(comp.type);\r\n            parent.addChild(panel);\r\n            parent.active = true;\r\n            if (comp && comp['show']) {\r\n                comp['show'].apply(comp, args);\r\n            }\r\n            cb && cb();\r\n            return;\r\n        }\r\n        let prefab = this.getPrefab(name);\r\n        let panel = prefab.create();\r\n        this.dictPanelMap.set(name, panel);\r\n        const comp = panel.getComponent(PanelBase);\r\n        const parent = this.getParent(comp.type);\r\n        parent.active = true;\r\n        parent.addChild(panel);\r\n        if (comp && comp['show']) {\r\n            comp['show'].apply(comp, args);\r\n        }\r\n        cb && cb();\r\n    }\r\n    hideAll() {\r\n        this.dictPanelMap.forEach((panel) => {\r\n            const comp = panel.getComponent(PanelBase);\r\n            if (comp && comp.isVisible) {\r\n                this.hidePage(panel.name);\r\n            }\r\n        });\r\n    }\r\n    getParent(type) {\r\n        switch (type) {\r\n            case UITYpes.PANEL:\r\n                return this._panelLayer;\r\n            case UITYpes.POPUP:\r\n                return this._popupLayer;\r\n            case UITYpes.TIP:\r\n                return this._tipLayer;\r\n            case UITYpes.EFFECT:\r\n                return this._effectLayer;\r\n        }\r\n    }\r\n    getPrefab(name) {\r\n        switch (name) {\r\n            case Constants.UIPage.home:\r\n                return this.homePage;\r\n            case Constants.UIPage.playing:\r\n                return this.playingPage;\r\n            case Constants.UIPage.relife:\r\n                return this.relifePage;\r\n            case Constants.UIPage.result:\r\n                return this.resultPage;\r\n            case Constants.UIPage.loading:\r\n                return this.loadingPage;\r\n            case Constants.UIPage.shop:\r\n                return this.shopPage;\r\n            case Constants.UIPage.info:\r\n                return this.infoPage;\r\n            case Constants.UIPage.setting:\r\n                return this.settingPage;\r\n            case Constants.UIPage.coinEffect:\r\n                return this.coinEffectPage;\r\n        }\r\n    }\r\n    getCoinPrefab() {\r\n        return this.coin;\r\n    }\r\n}\r\nGamePage.instance = null;\r\n",
  "references": [
    "D:/WorkSpace/Laya2.6.1/ShortcutRun/src/Data/Configuration.ts",
    "D:/WorkSpace/Laya2.6.1/ShortcutRun/src/Data/Constants.ts",
    "D:/WorkSpace/Laya2.6.1/ShortcutRun/src/Data/MiniGameManager.ts",
    "D:/WorkSpace/Laya2.6.1/ShortcutRun/src/Util/SdkUitl.ts",
    "D:/WorkSpace/Laya2.6.1/ShortcutRun/src/script/Singleton/AudioManager.ts",
    "D:/WorkSpace/Laya2.6.1/ShortcutRun/src/script/Singleton/GameManager.ts",
    "D:/WorkSpace/Laya2.6.1/ShortcutRun/src/script/Singleton/ShopManager.ts",
    "D:/WorkSpace/Laya2.6.1/ShortcutRun/src/script/UI/PanelBase.ts"
  ]
}
