!function(){"use strict";class t{}t.version="1.0.0",t.UIPage={home:"Home",playing:"Playing",relife:"Relife",result:"Result",loading:"Loading",shop:"Shop",info:"Info",setting:"Setting",coinEffect:"CoinEffect"},t.GameConfigID="SHORTCOU_RUN",t.LevelTick="level_tick",t.AudioConfigID="audioConfigID",t.PlayerInfoID="playerInfoID",t.ShopInfoID="shopInfoID",t.PlankChooseID="plankChooseID",t.GameRecordID="gameRecordID",t.DailyTick="dailyTick",t.MaxPlankSkin=8;class e{static register(t,e,a){this.handle[t]||(this.handle[t]=[]);const i={func:e,target:a};this.handle[t].push(i)}static unRegister(t,e,a){const i=this.handle[t];if(i&&!(i.length<=0))for(let t=0;t<i.length;t++){const s=i[t];if(s.func===e&&(!a||a===s.target)){i.splice(t,1);break}}}static dispatchEvent(t,...e){const a=this.handle[t];if(a&&!(a.length<=0))for(let t=0;t<a.length;t++){const i=a[t];i.func.apply(i.target,e)}}}var a,i,s,n,r;e.handle={},function(t){t[t.None=0]="None",t[t.Ready=1]="Ready",t[t.PreviewMap=2]="PreviewMap",t[t.Playing=3]="Playing",t[t.Pause=4]="Pause",t[t.Die=5]="Die",t[t.End=6]="End"}(a||(a={})),function(t){t[t.None=0]="None",t[t.Idle=1]="Idle",t[t.Run=2]="Run",t[t.Die=3]="Die",t[t.Win=4]="Win"}(i||(i={})),function(t){t.Idel="idle",t.Running="running",t.Falling="falling",t.Escalade="escalade",t.Back="back",t.Carrying="carrying",t.Jump="jump",t.Planche="planche",t.Defeated="defeated",t.Dance="dance",t.BigJump="bigJump"}(s||(s={})),function(t){t.Default="plank_hand_default",t.Bills="plank_hand_bills",t.Biscuit="plank_hand_biscuit",t.Diskstar="plank_hand_diskstar",t.Flower="plank_hand_flower",t.Gold="plank_hand_gold",t.Hotdog="plank_hand_hotdog",t.Overboard="plank_hand_overboard",t.Pizza="plank_hand_pizza"}(n||(n={})),function(t){t.MINI_GAME_START="mini-game-start",t.MINI_GAME_END="mini-game-end",t.MINI_GAME_DIE="mini-game-die",t.MINI_GAME_RELIFE="mini-game-relife",t.PLAYER_RELIFE="player-relife",t.ADD_MOENY="add-money",t.REDUCE_MOENY="reduce-money",t.ADD_SCORE="add-score",t.CHANGE_TITLE="change=title",t.CHANGE_WATER="change-water",t.SHOP_PLANK_CHOOSE="shop_plank_choose",t.SHOP_PLANK_BUY="shio_plank_buy",t.NEXT_LEVEL="next-level",t.PLAYER_PLANK_CHANGE="player-plank-change"}(r||(r={}));class o{}o.maxLevel=4,o.prefabRoot="subPackage/sub1/LayaScene_main/Conventional/",o.levelRoot="subPackage/sub1/LayaScene_main/remote/levels/",o.scenePath="subPackage/sub1/LayaScene_main/Conventional/main.ls",o.wordTexPath="subPackage/LayaScene_main/tex/",o.soundPath="subPackage/LayaScene_main/sounds/",o.roadTexPath="subPackage/sub1/RoadTextures/ground_",o.waterTexPath="subPackage/sub1/WaterTextures/water_",o.dataPath="data/",o.preload=["character_base.lh","water.lh","plank_road.lh","Turn_45_L.lh","Turn_45_R.lh","Turn_45_short_L.lh","Turn_45_short_R.lh","arrival.lh","fallEffect.lh","planks.lh","enemy.lh","Stright.lh","Cylinder.lh","plank_hand_default.lh","plank_hand_bills.lh","plank_hand_biscuit.lh","plank_hand_diskstar.lh","plank_hand_flower.lh","plank_hand_gold.lh","plank_hand_hotdog.lh","plank_hand_overboard.lh","plank_hand_pizza.lh","jumper.lh"],o.sounds=[],o.bgms=["bgm.mp3"],o.gameState=a.None,o.playerState=i.None,o.CollisionGroup_Obs=Laya.Physics3DUtils.COLLISIONFILTERGROUP_CUSTOMFILTER3;class h{constructor(){this._jsonData={},this._markSave=!1}static instance(){return this._instance||(this._instance=new h),this._instance}init(){const e=Laya.LocalStorage.getJSON(t.GameConfigID);e&&(this._jsonData=JSON.parse(e)),setInterval(this._scheduleSave.bind(this),500)}getConfigData(t){return this._jsonData[t]||""}setConfigData(t,e){this._jsonData[t]=e,this._markSave=!0}_scheduleSave(){if(!this._markSave)return;const e=JSON.stringify(this._jsonData);Laya.LocalStorage.setJSON(t.GameConfigID,e),this._markSave=!1}}h._instance=null;class l{constructor(){this._level=1}static instance(){return this._instance||(this._instance=new l),this._instance}loadLevelFromCache(){const e=h.instance().getConfigData(t.LevelTick);e&&(this._level=Number(JSON.parse(e)))}_saveLevelToCache(){const e=JSON.stringify(this._level);h.instance().setConfigData(t.LevelTick,e)}nextLevel(){this._level++,this._saveLevelToCache(),e.dispatchEvent(r.NEXT_LEVEL,this._level)}getSceneLevel(){return this._level}StartGame(){o.gameState=a.Playing,e.dispatchEvent(r.MINI_GAME_START)}EndGame(){o.gameState=a.End,e.dispatchEvent(r.MINI_GAME_END)}PauseGame(){o.gameState=a.Pause,e.dispatchEvent(r.MINI_GAME_RELIFE)}ResumeGame(){o.gameState=a.Playing}DieGame(){o.gameState=a.Die,e.dispatchEvent(r.MINI_GAME_DIE)}getRewardCoinCount(t){switch(t){case 1:return 200;case 2:return 100;case 3:return 50;case 4:return 10;default:return 0}}getRankScore(t){switch(t){case 1:return 3;case 2:return 2;case 3:return 1;default:return 0}}}l._instance=null;class c{constructor(){this.audioInfo=null}static instance(){return this._instance||(this._instance=new c),this._instance}getAudioData(){return this.audioInfo}loadFromCache(){const e=h.instance().getConfigData(t.AudioConfigID);e?this.audioInfo=JSON.parse(e):this._generateAudio()}saveAudioInfoToCache(){const e=JSON.stringify(this.audioInfo);h.instance().setConfigData(t.AudioConfigID,e)}_generateAudio(){this.audioInfo={musicMute:!1,effectMute:!1,musicVolume:.5,effectVolume:.5,vibrate:!0},this.saveAudioInfoToCache()}playMusic(t){this.audioInfo&&!this.audioInfo.musicMute&&P.playMusic(t,!0)}resumeMusic(){this.audioInfo&&this.audioInfo.musicMute}pasueMusic(){this.audioInfo&&this.audioInfo.musicMute}stopMusic(){}setVibrate(t){(this.audioInfo.vibrate=t)||(this.audioInfo.vibrate=t,this.saveAudioInfoToCache())}getVibrate(){return this.audioInfo.vibrate}setMusicVolume(t){}playEffect(t){if(this.audioInfo&&!this.audioInfo.effectMute){const e=`subPackage/sub2/Audio/Effect/${t}.mp3`;Laya.SoundManager.playSound(e)}}setAudioMute(t){this.audioInfo.effectMute!=t&&(this.audioInfo.effectMute=t,this.audioInfo.musicMute=t,this.saveAudioInfoToCache())}getAudioMute(){return this.audioInfo.effectMute}stopAllEffects(){}setEffectVolume(t){}}c._instance=null;class d{constructor(){this._recordCount=0}static instance(){return this._instance||(this._instance=new d),this._instance}loadFromCache(){const e=h.instance().getConfigData(t.GameRecordID);e&&(this._recordCount=JSON.parse(e))}saveInfoToCache(){const e=JSON.stringify(this._recordCount);h.instance().setConfigData(t.GameRecordID,e)}canShowReward(){return!!Laya.Browser.window.tt&&this._recordCount<3}resetHRecord(){this._recordCount=0,this.saveInfoToCache()}addRecordCount(){this.canShowReward()&&(this._recordCount++,this.saveInfoToCache())}}d._instance=null;class y{static Random(t=0,e=1){return t+(e-t)*Math.random()}static RandomInteger(t=0,e=1){let a=this.Random(t,e);return Math.floor(a)}static Shuffle(t){for(let e=t.length-1;e>=0;e--){let a=Math.floor(Math.random()*e),i=t[a];t[a]=t[e],t[e]=i}return t}}const u="",p="4j4fnj2n21l1d96165",m="4j4fnj2n21l1d96165",_="drnbifjl3ij4uobqt8",g="drnbifjl3ij4uobqt8",f="1qcmqpo0hd32npln2s",w=10,L=30,I=600;class P{static share(t=!1,e,a){if(Laya.Browser.window.tt){if(!tt.shareAppMessage)return;y.RandomInteger(0,this.images.length);var i=Math.random();let s=i<.25?1:i<.5?2:i<.75?3:4,n=this.shareWords[s-1],r="subPackage/sub2/Share/"+String(s)+".jpg";t?tt.shareAppMessage({channel:"video",title:n,query:"",templateId:u,extra:{videoPath:this.videoPath,videoTopics:["欢乐搬砖人"],hashtag_list:["欢乐搬砖人"]},success:t=>{console.log("录屏发布成功",t),d.instance().canShowReward()&&d.instance().addRecordCount(),e&&(e(),this.videoPath="")},fail:e=>{if(!t)return;let i=e.errMsg.split(":");console.log(i[1],"errs录屏发布失败"),-1!=i[1].search("cancel")?(console.log("取消发布录屏"),a&&a()):a&&a()}}):tt.shareAppMessage({title:n,templateId:u,imageUrl:r,query:"",success:()=>{},fail:()=>{}})}else;}static passiveShare(t=!1){Laya.Browser.onWeiXin&&wx.showShareMenu({withShareTicket:t,success:()=>{wx.onShareAppMessage(()=>{var t=Math.random();let e=t<.25?1:t<.5?2:t<.75?3:4;return{title:this.shareWords[e-1],imageUrl:"subPackage/sub2/Share/"+String(e)+".jpg",query:"",success:()=>{}}})},fail:()=>{console.log("显示当前页面的转发按钮--失败！")}}),Laya.Browser.window.tt&&tt.showShareMenu&&tt.showShareMenu({withShareTicket:!0,success:()=>{tt.onShareAppMessage(()=>{let t=y.RandomInteger(0,this.images.length);this.images[t]["des"+y.RandomInteger(1,4)],this.images[t].imageUrl})}})}static createVideoRewardAd(){if(Laya.Browser.onWeiXin){if(!wx.createRewardedVideoAd)return;return this._videoRewardAd=wx.createRewardedVideoAd({adUnitId:p}),this._videoRewardAd.onLoad&&this._videoRewardAd.onLoad(function(t){console.log("视频广告加载完成",t)}),this._videoRewardAd.onError&&this._videoRewardAd.onError(function(t){console.log("视频广告加载失败",t)}),void(this._videoRewardAd.onClose&&this._videoRewardAd.onClose(this.handler.bind(this)))}if(Laya.Browser.window.tt){if(!tt.createRewardedVideoAd)return;this._videoRewardAd=tt.createRewardedVideoAd({adUnitId:m}),this._videoRewardAd.onLoad&&this._videoRewardAd.onLoad(function(t){console.log("视频广告加载完成",t)}),this._videoRewardAd.onError&&this._videoRewardAd.onError(function(t){console.log("视频广告加载失败",t)}),this._videoRewardAd.onClose&&this._videoRewardAd.onClose(this.handler.bind(this))}}static loadVideoRewardAd(){return new Promise((t,e)=>{if(!this._videoRewardAd)return P.createVideoRewardAd(),void t();this._videoRewardAd.load().then(e=>{P.isRewardAdLoadComplete=!0,console.log("reward load complete"),t()},e=>{console.log("reward load err",e),P.isRewardAdLoadComplete=!1,t()})})}static showVideoRewardAd(t,e){return new Promise((a,i)=>{Laya.Browser.onWeiXin?(this.setVideoRewardAdCloseEvent(t,e),this.showVideo().then(t=>{a()},t=>{i()})):Laya.Browser.window.tt?(this.setVideoRewardAdCloseEvent(t,e),this.showVideo().then(t=>{a()},t=>{i()})):(t(),a())})}static showVideo(){return new Promise((t,e)=>{if(this._videoRewardAd){if(!this.isRewardAdLoadComplete)return P.loadVideoRewardAd(),void e();this._videoRewardAd.show&&this._videoRewardAd.show().then(e=>{console.log("视频广告显示成功，暂停背景音乐"),t(this._videoRewardAd)},t=>{console.log("视频广告显示失败",t),P.isRewardAdLoadComplete=!1,P.ShowToast("暂无广告，请稍后再试~"),this._videoRewardAd.load(),e()})}else P.createVideoRewardAd(),e()})}static closeHandler(t){t&&t.isEnded||void 0===t?(console.log("给予奖励"),this.videoSuccessCallback&&this.videoSuccessCallback()):(console.log("未看完广告"),this.videoFailCallback&&this.videoFailCallback())}static setVideoRewardAdCloseEvent(t,e){this.videoSuccessCallback=t,this.videoFailCallback=e}static showVideoReward(t,e){this._videoRewardAd&&this._videoRewardAd.show&&this._videoRewardAd.show().then(()=>{console.log("视频广告显示成功，暂停背景音乐"),P.setVideoRewardAdCloseEvent(t,e)},t=>{console.log("视频广告显示失败",t),this._videoRewardAd.load()})}static showBanner(){if(Laya.Browser.onWeiXin){if(!this.isBannerLoadComlete)return void P.createBanner().catch(t=>{console.log("create banner err")});this.banner_showCount>=w?(console.log("showBanner, 曝光次数达到设定值，需要重新创建再显示"),P.createBanner().then(t=>{})):this.bannerAd&&this.bannerAd.show&&this.bannerAd.show().then(()=>{this.isBannerDisplay=!0,this.banner_showCount++})}else if(Laya.Browser.window.tt){if(!this.isBannerLoadComlete)return void P.createBanner().catch(t=>{console.log("create banner err")});this.banner_showCount>=w?(console.log("showBanner, 曝光次数达到设定值，需要重新创建再显示"),P.createBanner().then(t=>{})):this.bannerAd&&this.bannerAd.show&&this.bannerAd.show().then(()=>{this.isBannerDisplay=!0,this.banner_showCount++})}}static hideBanner(){Laya.Browser.onWeiXin?this.isBannerDisplay&&(this.isBannerDisplay=!1,this.bannerAd&&this.bannerAd.hide&&this.bannerAd.hide()):Laya.Browser.window.tt&&this.isBannerDisplay&&(this.isBannerDisplay=!1,this.bannerAd&&this.bannerAd.hide&&this.bannerAd.hide())}static createBanner(){return new Promise((t,e)=>{if(Laya.Browser.onWeiXin){if(wx.createBannerAd){let a=wx.getSystemInfoSync(),i=a.screenWidth,s=a.screenHeight,n={adUnitId:_,adIntervals:L,style:{left:0,top:0}};P.destoryBanner(),this.bannerAd=wx.createBannerAd(n),this.bannerAd.style.left=(i-200)/2,this.bannerAd.onError(t=>{console.log("banner 加载失败",t),P.destoryBanner(),e(t)}),this.bannerAd.onLoad(e=>{console.log("banner 加载成功",e),this.isBannerLoadComlete=!0,t()}),this.bannerAd.onResize(t=>{this.isBannerResize||(this.isBannerResize=!0,0==t.height&&(t.height=108),this.bannerAd.style.top=s-t.height,this.bannerAd.style.left=(i-t.width)/2)})}}else if(Laya.Browser.window.tt&&tt.createBannerAd){let a=tt.getSystemInfoSync(),i=a.screenWidth,s=a.screenHeight,n={adUnitId:g,adIntervals:L,style:{left:0,top:0}};P.destoryBanner(),this.bannerAd=tt.createBannerAd(n),this.bannerAd.style.left=(i-200)/2,this.bannerAd.onError(t=>{console.log("banner 加载失败",t),P.destoryBanner(),e(t)}),this.bannerAd.onLoad(e=>{console.log("banner 加载成功",e),this.isBannerLoadComlete=!0,t()}),this.bannerAd.onResize(t=>{this.isBannerResize||(this.isBannerResize=!0,0==t.height&&(t.height=108),this.bannerAd.style.top=s-t.height,this.bannerAd.style.left=(i-t.width)/2)})}})}static destoryBanner(){this.isBannerDisplay=!1,this.isBannerLoadComlete=!1,this.isBannerResize=!1,this.banner_showCount=0,this.bannerAd&&(this.bannerAd.destroy&&this.bannerAd.destroy(),this.bannerAd=null)}static isLongHeight(){return!!Laya.Browser.onWeiXin&&(Laya.Browser.window.tt?(this.systemInfo||(this.systemInfo=tt.getSystemInfoSync()),this.systemInfo.screenHeight/this.systemInfo.screenWidth>=2):(this.systemInfo||(this.systemInfo=wx.getSystemInfoSync()),this.systemInfo.screenHeight/this.systemInfo.screenWidth>=2))}static createInterstital(t=!1){if(P.destoryInterstitial(),this.interstitialAd=null,Laya.Browser.window.tt){if(tt.createInterstitialAd){let e={adUnitId:f};this.interstitialAd=tt.createInterstitialAd(e),this.interstitialAd&&this.interstitialAd.load&&this.interstitialAd.load().then(()=>{console.log("interstitialAd 加载成功"),t&&this.interstitialAd&&this.interstitialAd.show&&this.interstitialAd.show().then(()=>{console.log("interstitialAd显示成功")}).catch(t=>{console.log("interstitialAd显示失败",t)})})}}else if(Laya.Browser.onWeiXin&&wx.createInterstitialAd){let e={adUnitId:f};this.interstitialAd=wx.createInterstitialAd(e),this.interstitialAd&&this.interstitialAd.load&&this.interstitialAd.load().then(()=>{console.log("interstitialAd 加载成功"),t&&this.interstitialAd&&this.interstitialAd.show&&this.interstitialAd.show().then(()=>{console.log("interstitialAd显示成功")}).catch(t=>{console.log("interstitialAd显示失败",t)})})}}static showInterstitialAd(){this.createInterstital(!0)}static destoryInterstitial(){this.interstitialAd&&(this.interstitialAd.destory&&this.interstitialAd.destory(),this.interstitialAd=null)}static playMusic(t,e=!0){if(Laya.Browser.onWeiXin)return void(wx.createInnerAudioContext&&(this._audio=wx.createInnerAudioContext(),this._audio.src=`subPackage/sub2/Audio/Effect/${t}.mp3`,this._audio.autoplay=!0,this._audio.loop=!0,this._audio.play()));Laya.Browser.window.tt&&tt.createInnerAudioContext&&(this._audio=tt.createInnerAudioContext(),this._audio.src=`subPackage/sub2/Audio/Effect/${t}.mp3`,this._audio.autoplay=!0,this._audio.loop=!0,this._audio.play());let a=`subPackage/sub2/Audio/Effect/${t}.mp3`,i=e?0:1;Laya.SoundManager.playMusic(a,i)}static loadSubpackage(t,e){if(Laya.Browser.onWeiXin){if(wx.loadSubpackage){return wx.loadSubpackage({name:t,success:function(t){e&&e()},fail:function(t){}})}}else{if(!Laya.Browser.window.tt)return e&&e(),null;if(console.log("字节分包++++"),tt.loadSubpackage){return tt.loadSubpackage({name:t,success:function(t){e&&e()},fail:function(t){}})}}}static vibrateShort(){c.instance().getVibrate()&&(Laya.Browser.onWeiXin?wx.vibrateShort&&wx.vibrateShort({type:"light"}):Laya.Browser.window.tt&&tt.vibrateShort&&tt.vibrateShort())}static ShowToast(t="",e="none",a=1500){Laya.Browser.window.wx?wx.showToast({title:t,icon:e,duration:a}):Laya.Browser.window.tt&&tt.showToast({title:t,icon:e,duration:a})}static initGameRecorder(){Laya.Browser.window.tt&&tt.getGameRecorderManager&&(this.gameRecorder||(this.gameRecorder=tt.getGameRecorderManager()),this.gameRecorder.onStart(t=>{console.log("开始录屏",t),this.videoPath="",this.startGameRecorderTime=(new Date).getTime(),P.isGameRecordStop=!1}),this.gameRecorder.onStop(t=>{console.log("录制结束",t),P.isGameRecordStop=!0,this.endGameRecorderTime=(new Date).getTime(),this.videoPath=t.videoPath;let e=this.stopCallback,a=this.stopEndCallback;this.gameRecorder.clipVideo({path:t.videoPath,timeRange:[I,0],success(t){console.log(t.videoPath),e&&e(),a&&a()},fail(t){console.error(t),a&&a()}})}))}static startGameRecord(){Laya.Browser.window.tt&&this.gameRecorder&&this.gameRecorder.start({duration:I})}static stopGameRecord(t,e){Laya.Browser.window.tt&&(this.isGameRecordStop?e&&e():this.gameRecorder&&(this.stopCallback=t||null,this.stopEndCallback=e||null,this.gameRecorder.stop()))}static canReleaseGameRecord(){return!!Laya.Browser.window.tt&&(!(this.endGameRecorderTime-this.startGameRecorderTime<=3e3||""==this.videoPath||!this.isGameRecordStop)||(P.ShowToast("视频不足3秒无法发布，请重新录制！"),this.videoPath="",!1))}static releaseGameRecord(t,e){Laya.Browser.window.tt&&this.share(!0,t,e)}}P.images=[{des1:"搬砖搬的好，躺平躺的快~",des2:"谁才是直播界带货一哥？",des3:"招募主播，直播带货，生意蒸蒸日上！",imageUrlId:"M9YkQjdARgCfpupY+bmNWg==",imageUrl:"https://mmocgame.qpic.cn/wechatgame/svmLHWrwdtCYgLpZSS63QZgMVfWXicOgOzkRYs9U4MWJvcqhRlkCc5RX6yYzNftB3/0"},{des1:"音乐奇才，无人倾听，经纪人们快来帮帮他~",des2:"情歌天王，千万人气，为何深夜独自神伤？",des3:"流浪歌手到亚洲歌王，阿呆的梦想！",imageUrlId:"tG+4Q4WqTjGtAYjdg8YDNA==",imageUrl:"https://mmocgame.qpic.cn/wechatgame/svmLHWrwdtCXN4yFyb3E95qdaYVoTxia4fOntH6sDskhelq7sK7CPlCgKunhQ3keb/0"},{des1:"猪二蛋：欢迎来的我的直播间！",des2:"打造属于你自己的直播天团吧！",des3:"大胃王猪二蛋高调路过，聘请他来直播吧~",imageUrlId:"xbKpyKtLQAi4ieYtjqNVUw==",imageUrl:"https://mmocgame.qpic.cn/wechatgame/svmLHWrwdtDVs2rjY0ZJKXlnhB8STMuHiaibI7C7iaSSvgjjHDmToalpa7uHzfiaKuibx/0"}],P.gameRecorder=null,P.videoPath="",P.stopCallback=null,P.stopEndCallback=null,P.shareWords=["搬砖搬的好，躺平躺的快~","打工人，打工魂，我是最强搬砖人！","还好我搬的砖多，不然就掉下去了！","宝~我今天扛了好多砖，但就是扛不住想你~"],P.handler=P.closeHandler,P.isRewardAdLoadComplete=!1,P.banner_showCount=0,P.isBannerDisplay=!1,P.isBannerLoadComlete=!1,P.isBannerResize=!1,P.panelDisplayCount=4,P._audio=null,P.isGameRecordStop=!0;class v{static getArrivalPos(){return this.arrival_pos_array.length<=0?null:this.arrival_pos_array.pop()}static resetData(){this.arrival_pos_array.length=0,this.playerInfos.length=0,this.rank=1,this.playRank=1,this.rewardCoin=0,this.rewardScore=0,this.canRelife=!0}static RandomName(){return["凄美如画","土豆沙","茕茕孑立"," 追风逐月","剑舞琴扬","天涯为客","静候缘来","慕雪剑心","慕血十三","小天使","泡泡龙","tina","for_love","花菲","可儿","非想","开元","杰克","大朋友","尓蕞紾貴","大棒","灵兰若梦","锦瑟幽心","冰城","文远","阿红","都是辣鸡","蛰伏","柯","天涯","森舟","似曾相识","可可妈","醉红尘","莲波仙子","bibe","小棉","金色","卖了一个世界","袭夜风","一颗海藻","wei","獨留記憶:","HGC、","车♀神","吥丶可能","额滴个神","窈窕","梦入晚花","爲愛鼓掌","雨","落樱纷飞","马猴烧酒","向阳花","白衣少年","幸运烟雨","斗宗强者","三师公","步步为赢","苍了微凉","枫林晚","卡哇伊","乘风破~","欧豆豆","史迪仔","斯給妳","积灰石台","此夜此月","干净月光","故人长安","崖山一夜","山河故人","干净利落","给我盘ta","古道西风","十里桃花","话在心里","G.I钟","黑凤梨~","几度几分","尽揽风月","静待花开","孤海微凉","淮南柚香","格桑花","闰土与猹","蓝涩雨蝶","兔女郎","会飞的鱼","佛剑分说","两小无猜","也总","安得广厦","焚琴煮鹤","青阳","钢炼","笑在眉眼","我是雨师..","我是演员","青梅煮马","瘦马淡雾","小仙女","狗骑兔子","醉酒当歌","晴天飞雪","破~伤风","卧龙跃马","一场惊鸿","biu,爽","寒光冷照","失心疯","雨伞风听","新鲜感觉","如之奈何","君子剑","烈酒入喉","杂修","剑指天涯","山中老人","时辰的错","救赎乀","夜雨沧皮","醉饮千山","不离不弃","莫山主","冷战思维","猪头帝","单相思","猪头少年","红袖依然","独角戏","冬去春来","冰轮","乱了头发","天国比雕","锁心神笔","留级生","有烟无伤","疯狂游戏","小奶狗","余温余情","joe","好人卡","三刀流","贰零壹玖","朱颜华发","万人敌","死肥宅","竹楼醉酒","仅仅喜欢","甲方","人心所向","韩晓飞","如你所愿","冷漾船舷","又是一年","周扒皮","君莫笑","飞刀","四月绿","心安如梦","流沙","烟云浮华","弃总","走路草","追忆流年"]}static getName(){let t,e=Math.floor(Math.random()*v.name_array.length);return t=v.name_array.splice(e,1)[0]}}v.maxLevel=20,v.arrival_pos_array=[],v.roadTex_map=new Map,v.waterTex_map=new Map,v.isShake=!0,v.isShowHome=!1,v.name_array=[],v.canRelife=!0,v.rank=1,v.rewardCoin=0,v.rewardScore=0,v.playRank=1,v.playerInfos=[],v.excited=!1;class S extends Laya.EventDispatcher{static get instance(){return!this._instance&&(this._instance=new S),this._instance}}S.on_pass_level="on_pass_level",S.on_fail_level="on_fail_level",S.on_clear_scene="on_clear_scene",S.on_level_loaded="on_level_loaded",S.on_game_ready="on_game_ready",S.on_game_start="on_game_start",S.on_back_home="on_back_home",S.on_game_reset="on_game_reset",S.on_show_tip="on_show_tip",S.msg_draw_end="msg_draw_end",S.msg_be_discovered="msg_be_discovered",S.msg_be_freezed="msg_be_freezed",S.msg_off_trap="msg_off_trap",S.msg_switch_enter="msg_switch_enter",S.msg_hit_enemy="msg_hit_enemy",S.msg_camera_move="msg_camera_move",S.msg_save_princess="msg_save_princess";var C=Laya.Handler;class A extends Laya.Script3D{onAwake(){S.instance.on(S.on_clear_scene,this,this.onClearScene),this.transform=this.owner.transform}destroy(){this.owner&&(this.owner.removeSelf(),this.owner.destroy()),this.destroyed||this.destroy()}onDestroy(){Laya.timer.clearAll(this)}onUpdate(){}smoothDestroy(t=1e3){this.destroyed||this.owner.traverse(e=>{if(e instanceof Laya.MeshSprite3D){let a=e.meshRenderer.material;a.renderMode=2,Laya.Tween.to(a,{albedoColorA:0},t,Laya.Ease.linearNone,C.create(null,()=>{this.destroy()}))}})}smoothBlack(t=500,e=!0){this.destroyed||this.owner.traverse(a=>{if(a instanceof Laya.MeshSprite3D){let i=a.meshRenderer.material;i.renderMode=2,Laya.Tween.to(i,{_ColorR:0,_ColorG:0,_ColorB:0},t,Laya.Ease.linearNone,C.create(null,()=>{e&&this.destroy()}))}})}smoothBlackSkinned(t=500,e=!0){this.destroyed||this.owner.traverse(a=>{if(a instanceof Laya.SkinnedMeshSprite3D){let i=a.skinnedMeshRenderer.material;i.renderMode=2,Laya.Tween.to(i,{_ColorR:0,_ColorG:0,_ColorB:0},t,Laya.Ease.linearNone,C.create(null,()=>{e&&this.destroy()}))}})}onClearScene(){Laya.timer.clearAll(this)}}var x=Laya.Vector3,b=Laya.Quaternion;class k extends A{get tag(){return this.data.tag}get entityId(){return this.data.id}init(t){this.data=t;new x,new b,new x;let e=(new Laya.Matrix4x4).fromArray(t.transform);switch(this.transform.worldMatrix=e,this.tag){case"arrival":v.arrival_pos=this.transform.position.clone()}}onDestroy(){super.onDestroy()}}class R extends k{onAwake(){super.onAwake(),this._arrival=this.owner,this._boom=this._arrival.getChildByName("boom"),e.register(r.MINI_GAME_END,this._showBoom,this)}onDestroy(){e.unRegister(r.MINI_GAME_END,this._showBoom,this)}init(t){super.init(t),this.setArrivalPosArray(),this._hideBoom()}setArrivalPosArray(){v.arrival_pos_array.length=0;let t=[],e=this._arrival.transform.position.clone(),a=new Laya.Vector3(e.x-2,e.y,e.z);t.push(a);let i=new Laya.Vector3(e.x+2,e.y,e.z);t.push(i);let s=new Laya.Vector3(e.x,e.y,e.z+2);t.push(s);let n=new Laya.Vector3(e.x,e.y,e.z-2);t.push(n),t.push(e),v.arrival_pos_array=t}_hideBoom(){this._boom.active&&(this._boom.active=!1)}_showBoom(){this._boom.active||(this._boom.active=!0)}}class T extends Laya.Script3D{constructor(){super(),this._start_moving=!1,T.instance=this}onAwake(){this._camera=this.owner,this._cameraPos=this._camera.transform.position.clone()}onEnable(){e.register(r.PLAYER_PLANK_CHANGE,this.changeCameraFieldOfView,this),e.register(r.MINI_GAME_END,this.changeCameraToFinal,this)}onDisable(){e.unRegister(r.PLAYER_PLANK_CHANGE,this.changeCameraFieldOfView,this),e.unRegister(r.MINI_GAME_END,this.changeCameraToFinal,this)}initPlayerData(t,e){this._target=t,this._point=e,this._start_moving=!1,this._camera.fieldOfView=50}onLateUpdate(){Laya.timer.delta>100||o.gameState==a.Playing&&(this._cameraPointTween(this._point,this._target),this._lookAtTarget(this._target,this._point))}_lookAtTarget(t,e){if(!t||!e)return;let a=e.transform.position;this._cameraPos.setValue(a.x,a.y,a.z),this._camera.transform.position=this._cameraPos,this._camera.transform.lookAt(t.transform.position,Laya.Vector3.up)}_cameraPointTween(t,e){t&&!this._start_moving&&e&&(this._start_moving=!0,Laya.Tween.clearAll(this._camera),Laya.Tween.to(this._camera,{fieldOfView:40},500,Laya.Ease.linearIn),Laya.Tween.to(t.transform,{localPositionZ:-10,localPositionY:5},1e3,null,Laya.Handler.create(this,()=>{})))}changeCameraFieldOfView(t){Laya.Tween.clearAll(this._camera);let e=45+t/2;e>80&&(e=80),Laya.Tween.to(this._camera,{fieldOfView:e},200,Laya.Ease.linearIn)}changeCameraToFinal(){Laya.Tween.clearAll(this._camera),Laya.Tween.to(this._camera,{fieldOfView:40},1500,Laya.Ease.linearIn)}}T.instance=null;class E{constructor(){this.effects={}}static get instance(){return this._instance||(this._instance=new E),this._instance}loadEffect(t,e=1e3,a,i){return new Promise(s=>{this.effects[t]||(this.effects[t]=[]);let n=this.effects[t];if(n.length>0){let t=n.pop();(i||v.scene3d).addChild(t),t.transform.position=a,-1!=e&&Laya.timer.once(e,this,t=>this.recycleEffect(t),[t]),s(t)}else Laya.Sprite3D.load(o.prefabRoot+t+".lh",Laya.Handler.create(null,t=>{let n=Laya.Sprite3D.instantiate(t);(i||v.scene3d).addChild(n),n.transform.position=a,-1!=e&&Laya.timer.once(e,this,t=>this.recycleEffect(t),[n]),s(n)}))})}recycleEffect(t){t.removeSelf(),this.effects[t.name]&&this.effects[t.name].push(t)}clear(){for(const t in this.effects)if(this.effects.hasOwnProperty(t)){this.effects[t].map(t=>t.destroy())}this.effects={}}}class M{constructor(){this.plankHand_array=[],this.plankRoad_array=[],this.effect_map=new Map,this.cube_scale=new Laya.Vector3(1,1,1)}static get instance(){return this._instance||(this._instance=new M),this._instance}static Spawn(t,e,a){let i;if(this.handle.has(t)&&this.handle.get(t).length>0)i=this.handle.get(t).pop(),e.addChild(i);else{let a=Laya.loader.getRes(o.prefabRoot+t+".lh");i=Laya.Sprite3D.instantiate(a,e,!0)}return i.transform.position=a,i.active=!0,i}static RecycleObj(t,e){if(t.removeSelf(),this.handle.has(e))this.handle.get(e).push(t);else{let a=[];a.push(t),this.handle.set(e,a)}}getPlank_hand(t,e){let a;if(this.plankHand_array.length<=0){let e=Laya.loader.getRes(o.prefabRoot+"plank_hand.lh");a=Laya.Sprite3D.instantiate(e,t,!0)}else a=this.plankHand_array.pop(),t.addChild(a);return a.transform.position=e,a.active=!0,a}getPlank_road(t,e){let a;if(this.plankRoad_array.length<=0){let e=Laya.loader.getRes(o.prefabRoot+"plank_road.lh");a=Laya.Sprite3D.instantiate(e,t,!0)}else a=this.plankRoad_array.pop(),t.addChild(a);return a.transform.position=e,a.active=!0,a}reversePlankHandCube(t){t.active=!1,t.removeSelf(),this.plankHand_array.push(t)}reversePlankRoadCube(t){t.active=!1,t.removeSelf(),this.plankRoad_array.push(t)}clearPool(){let t=this.plankRoad_array.length;for(let e=0;e<t;e++){let t=this.plankRoad_array.pop();t&&(t.removeSelf(),t.destroy())}let e=this.plankHand_array.length;for(let t=0;t<e;t++){let t=this.plankHand_array.pop();t&&(t.removeSelf(),t.destroy())}this.plankHand_array.length=0,this.plankRoad_array.length=0}static getCoin(t,e){var a=null;return a=this.coinPool.length>0?this.coinPool.pop():t.create(),e.addChild(a),a}static putCoin(t){Laya.Tween.clearAll(t),t.removeSelf(),this.coinPool.push(t)}}M.handle=new Map,M.coinPool=[];var B={Planks:[{1001:{ID:1001,Name:"绿色默认",SpriteName:"default",Prefab:"plank_hand_default",Price:0,Ad:0},1002:{ID:1002,Name:"热狗",SpriteName:"hotdog",Prefab:"plank_hand_hotdog",Price:1e3,Ad:0},1003:{ID:1003,Name:"饼干",SpriteName:"biscuit",Prefab:"plank_hand_biscuit",Price:3e3,Ad:0},1004:{ID:1004,Name:"钞票",SpriteName:"bills",Prefab:"plank_hand_bills",Price:3e3,Ad:0},1005:{ID:1005,Name:"黄金",SpriteName:"gold",Prefab:"plank_hand_gold",Price:8e3,Ad:0},1006:{ID:1006,Name:"花",SpriteName:"flower",Prefab:"plank_hand_flower",Price:12e3,Ad:0},1007:{ID:1007,Name:"披萨",SpriteName:"pizza",Prefab:"plank_hand_pizza",Price:12e3,Ad:0},1008:{ID:1008,Name:"滑板",SpriteName:"overboard",Prefab:"plank_hand_overboard",Price:0,Ad:3},1009:{ID:1009,Name:"盾牌",SpriteName:"diskstar",Prefab:"plank_hand_diskstar",Price:0,Ad:3}}]};class D{static getPlanksRecord(t){let e=B.Planks[0];if(e)return t?e[t]:e;console.trace()}}class N extends k{constructor(){super(...arguments),this.forward_speed=.15,this.down_speed=.24,this.cube_count=0,this.cube_array=[],this.cube_height=.16,this.charactor_tween=new Laya.Tween,this.isRayCast=!1}onAwake(){super.onAwake(),this.player=this.owner,this.animator=this.player.getComponent(Laya.Animator)}onStart(){super.onStart(),this.initScene3d()}initScene3d(){this.physicsSimulation=v.scene3d.physicsSimulation}}const V=.15;class O extends N{constructor(){super(),this._canPop=!0,this._rotate_speed=4,this._isMoveArrival=!1,this._die=!1,this._toArrival=!1,this._final=!1,this._toRight=!1,this.targetArray=[],this.targetIndex=1,this._toTarget=!1,this._temp_vec3=new Laya.Vector3(0,0,0),this._forward=new Laya.Vector3(0,0,0),this.qua=new Laya.Quaternion}onAwake(){super.onAwake(),this.player=this.owner,this.trail=this.player.getChildByName("trail"),this.animator=this.player.getComponent(Laya.Animator),this.blank_point=this.player.getChildByName("plank_point"),this._left=this.player.getChildByName("left"),this._right=this.player.getChildByName("right"),this.playerMove=new Laya.Vector3(0,0,this.forward_speed),this.playerRotate=new Laya.Vector3(0,this._rotate_speed,0),this._point=this.player.getChildByName("point"),this.moveArrivalpointHandler=new Laya.Handler(this,this.moveArrivalpointCallback)}onStart(){super.onStart(),this.initRay(),this.playerInfo={name:v.getName(),rank:1,player:!1},v.playerInfos.push(this.playerInfo),this._hideTrail()}onEnable(){e.register(r.MINI_GAME_START,this.onGameStart,this),e.register(r.MINI_GAME_END,this.onGameEnd,this)}onDisable(){e.unRegister(r.MINI_GAME_START,this.onGameStart,this),e.unRegister(r.MINI_GAME_END,this.onGameEnd,this)}init(t){if(super.init(t),this.changePlayerState(s.Idel),this.cube_count=0,this._canPop=!0,this._die=!1,this._toArrival=!1,this._final=!1,this.path_array=t.pathArray,this.path_array)for(let t=0;t<this.path_array.length;t++){let e=(new Laya.Vector3).fromArray(this.path_array[t]);this.targetArray.push(e)}}onUpdate(){if(!(Laya.timer.delta>100||o.gameState==a.None||o.gameState==a.Ready||this._die||this._final))switch(this.rayCast(),this.animationState){case s.Planche:this._showTrail(),this._addSpeed(),this._moveForward(),this.player.transform.localPositionY<0&&(this.player.transform.localPositionY=0);break;case s.Carrying:case s.Running:this._hideTrail(),this.forward_speed=V,this.playerMove.setValue(0,0,this.forward_speed),this._moveForward(),this.player.transform.localPositionY<0&&(this.player.transform.localPositionY=0);break;case s.Jump:if(this.playerMove.y-=this._decreaseDownspeed(),this._moveForward(),this.juageWaterDistance()){this.enemyDie();let t=new Laya.Vector3(this.player.transform.position.x,-.5,this.player.transform.position.z);E.instance.loadEffect("fallEffect",-1,t).then(t=>{t.active=!0})}}}enemyDie(){this._die||(this._die=!0)}onGameStart(){this._die=!1,this._toArrival=!1,this._final=!1,this._toRight=!1,this.setPlankPrefab(),this.forward_speed=V,this.changePlayerState(s.Running),this.startRay(),this._hideTrail()}onGameEnd(){this._final||(this.playerInfo.rank=v.rank,v.rank++)}startRay(){this.isRayCast=!0}initRay(){this.ray_orign=this.player.transform.position.clone(),this.ray_down=new Laya.Ray(this.ray_orign,Laya.Vector3.down),this.outInfo=new Laya.HitResult,this.ray_left_orign=this._left.transform.position.clone(),this.ray_left_down=new Laya.Ray(this.ray_left_orign,Laya.Vector3.down),this.outInfo_left=new Laya.HitResult,this.ray_right_orign=this._right.transform.position.clone(),this.ray_right_down=new Laya.Ray(this.ray_right_orign,Laya.Vector3.down),this.outInfo_right=new Laya.HitResult}rayCast(){if(!this.physicsSimulation)return;if(!this.isRayCast)return;let t=this.player.transform.position;this.ray_orign.setValue(t.x,t.y+5,t.z),this.physicsSimulation.rayCast(this.ray_down,this.outInfo,20)&&this.refreshState(this.outInfo,this.animationState),this._toTarget&&this.targetPos?this.player.transform.lookAt(this.targetPos,Laya.Vector3.up,!1,!1):this._toArrival?this.player.transform.lookAt(v.arrival_pos,Laya.Vector3.up,!1,!1):(this._toRight&&(this._toRight=!1,this._rotateToRight()),this.rayLeftCast()&&this.rayRigtCast()||(this.rayLeftCast()?this._rotate(-1):this.rayRigtCast()&&this._rotate(1)))}refreshState(t,e){if(!t||!t.succeeded)return;let a=this.outInfo.collider.owner.name,i=t.point;switch(e){case s.Planche:switch(this._showTrail(),a){case"arrival":this._moveArrivalPoint(this.outInfo.collider.owner);break;case"water":this.cube_count>0?(this._popPlankToRoad(),this.changePlayerState(s.Planche)):this.changePlayerState(s.Jump);break;case"Cylinder":case"Turn_45_L":case"Turn_45_R":case"Turn_45_short_L":case"Turn_45_short_R":case"Stright":case"plank":this._toRight||(this._toRight=!0,this._part=this.outInfo.collider.owner),this.cube_count>0?this.changePlayerState(s.Carrying):this.changePlayerState(s.Running),this._toArrival&&(this._toArrival=!1),this._rotateToRight()}break;case s.Carrying:case s.Running:switch(this._hideTrail(),this.forward_speed=V,this.playerMove.setValue(0,0,this.forward_speed),a){case"arrival":this._moveArrivalPoint(this.outInfo.collider.owner);break;case"water":this.cube_count>0?(this._popPlankToRoad(),this.changePlayerState(s.Planche)):this.changePlayerState(s.Jump);break;case"plank":this._addPlankToEnemy(),this.changePlayerState(s.Carrying),t.collider.owner.removeSelf()}break;case s.Jump:switch(a){case"arrvial":this.juageRoadDistance()&&(this.player.transform.localPositionY<0&&(this.player.transform.localPositionY=0),this._moveArrivalPoint(this.outInfo.collider.owner));break;case"plank":case"Turn_45_L":case"Turn_45_R":case"Turn_45_short_L":case"Turn_45_short_R":case"Cylinder":case"Stright":this.juageRoadDistance()&&(this._toRight||(this._toRight=!0,this._part=this.outInfo.collider.owner),this._toArrival&&(this._toArrival=!1),this._rotateToRight(),this.changePlayerState(s.Running),this.player.transform.localPositionY<0&&(this.player.transform.localPositionY=0));break;default:"plank_hand"==a.substring(0,10)&&this.juageBlankDistance(i)&&this.changePlayerState(s.Running)}}}juageRoadDistance(){return this.player.transform.localPositionY<=0}juageBlankDistance(t){return this.player.transform.localPositionY-t.y<=.05}juageWaterDistance(){return this.player.transform.localPositionY<=-2.3}juageToArrival(){this._toArrival||this.cube_count>y.RandomInteger(12,16)&&(this._toArrival=!0,Laya.timer.once(1e3,this,()=>{this._toArrival=!1}))}rayLeftCast(){if(!this.physicsSimulation||!this.isRayCast)return!1;let t=this._left.transform.position;if(this.ray_left_orign.setValue(t.x,t.y,t.z),this.physicsSimulation.rayCast(this.ray_left_down,this.outInfo_left,20)){switch(this.outInfo_left.collider.owner.name){case"water":return!1;case"Turn_45_L":case"Turn_45_R":case"Turn_45_short_L":case"Turn_45_short_R":case"plank":case"arrival":case"Cylinder":case"Stright":return!0}}return!1}rayRigtCast(){if(!this.physicsSimulation||!this.isRayCast)return!1;let t=this._right.transform.position;if(this.ray_right_orign.setValue(t.x,t.y,t.z),this.physicsSimulation.rayCast(this.ray_right_down,this.outInfo_right,20)){switch(this.outInfo_right.collider.owner.name){case"water":return!1;case"Turn_45_L":case"Turn_45_R":case"Turn_45_short_L":case"Turn_45_short_R":case"plank":case"arrival":case"Cylinder":case"Stright":return!0}}return!1}_rotateToRight(){if(!this._part)return;let t=this._part.getChildAt(0);if(!t)return;let e=new Laya.Vector3(t.transform.position.x,0,t.transform.position.z);this.player.transform.lookAt(e,Laya.Vector3.up,!1,!1)}_moveForward(){this.player.transform.translate(this.playerMove,!0)}_decreaseDownspeed(){return Laya.timer.delta/1e3*.8}_rotate(t){this.playerRotate.setValue(0,-this._rotate_speed*t*Laya.timer.delta/1e3,0),this.player.transform.rotate(this.playerRotate,!0)}changePlayerState(t){if(this.animationState!=t)switch(this._playAnimation(t),t){case s.Planche:case s.Carrying:case s.Running:this.playerMove.setValue(0,0,this.forward_speed);break;case s.Jump:this.playerMove.setValue(0,this.down_speed,this.forward_speed);break;case s.Idel:this.playerMove.setValue(0,0,0)}}_playAnimation(t){this.animationState=t,t==s.Planche?this.animator.speed=1.5:this.animator.speed=1,this.animator.play(t)}_addPlankToEnemy(){this.cube_count++;let t=new Laya.Vector3;if(this.cube_array.length>0){let e=this.cube_array[this.cube_array.length-1];t.setValue(e.transform.position.x,e.transform.position.y+this.cube_height,e.transform.position.z)}else t=this.blank_point.transform.position.clone();let e=M.Spawn(this._plank_prefab,this.blank_point,t),a=e.getComponent(Laya.Animator);a.enabled=!0,a.play("blank_push"),e.getComponent(Laya.PhysicsCollider).enabled=!1;let i=e.transform.localPositionY+.2;Laya.Tween.from(e.transform,{localPositionY:i},.6),e.transform.rotation=this.blank_point.transform.rotation,this.cube_array.push(e),this.path_array&&this.path_array&&this.targetIndex<this.targetArray.length?this._jungeToTarget():this.juageToArrival()}_jungeToTarget(){this._toTarget||this.cube_count>y.RandomInteger(6,7)&&(this._toTarget=!0,this.targetPos=this.targetArray[this.targetIndex],Laya.timer.once(1e3,this,()=>{this.targetIndex++,this._toTarget=!1}))}_popPlankToRoad(){if(!this._canPop)return;if(this.cube_array.length<=0)return;let t=this.cube_array.pop();this.cube_count--,M.RecycleObj(t,this._plank_prefab);let e=M.Spawn(this._plank_prefab,v.map,this.player.transform.position.clone());e.transform.rotation=this.player.transform.rotation.clone(),e.transform.setWorldLossyScale(Laya.Vector3.one),e.getComponent(Laya.Animator).enabled=!1,e.getComponent(Laya.PhysicsCollider).enabled=!0,this._canPop=!1,Laya.timer.once(200,this,()=>{this._canPop=!0})}_addSpeed(){this.forward_speed<V+.15&&(this.forward_speed+=Laya.timer.delta/1e3*.01,this.playerMove.setValue(0,0,this.forward_speed))}_clearPlank(){Laya.timer.frameLoop(1,this.player,()=>{if(this.cube_array.length<=0)return void Laya.timer.clearAll(this.player);let t=this.cube_array.pop();this.cube_count--,M.RecycleObj(t,this._plank_prefab)})}_moveArrivalPoint(t){if(this._isMoveArrival)return;if(!t)return;this._clearPlank(),this._hideTrail(),this.changePlayerState(s.Running);let e=v.getArrivalPos();this._isMoveArrival=!0,this._clearMoveTween(),this.player.transform.lookAt(e,Laya.Vector3.up,!1,!1),this.charactor_tween.to(this.player.transform,{localPositionX:e.x,localPositionZ:e.z},500,null,this.moveArrivalpointHandler)}_clearMoveTween(){this.charactor_tween.clear()}moveArrivalpointCallback(){this._final||(this.playerInfo.rank=v.rank,v.rank++,this._final=!0,1===this.playerInfo.rank?this.changePlayerState(s.Dance):this.changePlayerState(s.Defeated))}setPlankPrefab(){let t=D.getPlanksRecord(),e=Object.keys(t);this._plank_prefab=t[e[Math.floor(Math.random()*e.length)]].Prefab}_showTrail(){this.trail.active||(this.trail.active=!0)}_hideTrail(){this.trail.active&&(this.trail.active=!1)}}class G extends k{onAwake(){super.onAwake(),this._jumper=this.owner,this._arrow=this._jumper.getChildByName("arrow"),this._jumperAnimater=this._jumper.getChildByName("jumper.001").getChildAt(0).getComponent(Laya.Animator)}playJumpAni(){this._jumperAnimater.play(),c.instance().playEffect("Jumper")}}var U;!function(t){t.QINGTONG="搬砖青铜",t.BAIYING="搬砖白银",t.HUANGJING="搬砖黄金",t.BOJING="搬砖铂金",t.ZHUANSHI="搬砖砖石",t.DASHI="搬砖大师",t.WANGZHE="搬砖王者"}(U||(U={}));class z{constructor(){this.playerTitle=U.HUANGJING}static instance(){return this._instance||(this._instance=new z),this._instance}loadFromCache(){const e=h.instance().getConfigData(t.PlayerInfoID);console.log(e,"playerINfo++++++++++"),e?(this.playerInfo=JSON.parse(e),this.playerInfo.score||(this.playerInfo.score=0)):this.playerInfo={money:0,score:0}}savePlayerInfoToCache(){const e=JSON.stringify(this.playerInfo);h.instance().setConfigData(t.PlayerInfoID,e)}addMoney(t,a=!1){this.playerInfo.money+=t,this.savePlayerInfoToCache(),a||e.dispatchEvent(r.ADD_MOENY)}reduceMoney(t){return this.playerInfo.money>=t&&(this.playerInfo.money-=t,this.savePlayerInfoToCache(),e.dispatchEvent(r.REDUCE_MOENY),!0)}addScore(t){this.playerInfo.score+=t,this.savePlayerInfoToCache(),e.dispatchEvent(r.ADD_SCORE)}setPlayerTitle(){let t=this.playerInfo.score;t<15?this.playerTitle=U.QINGTONG:t>=15&&t<40?this.playerTitle!=U.BAIYING&&(this.playerTitle=U.BAIYING,e.dispatchEvent(r.CHANGE_TITLE)):t>=40&&t<80?this.playerTitle!=U.HUANGJING&&(this.playerTitle=U.HUANGJING,e.dispatchEvent(r.CHANGE_TITLE)):t>=80&&t<140?this.playerTitle!=U.BOJING&&(this.playerTitle=U.BOJING,e.dispatchEvent(r.CHANGE_TITLE)):t>=140&&t<200?this.playerTitle!=U.DASHI&&(this.playerTitle=U.DASHI,e.dispatchEvent(r.CHANGE_TITLE)):this.playerTitle!=U.WANGZHE&&(this.playerTitle=U.WANGZHE,e.dispatchEvent(r.CHANGE_TITLE))}getPlayerTitle(){return this.playerTitle}}z._instance=null;class H{constructor(){this._unlockIDMap=new Map,this._unlockIDSaveList=[]}static instance(){return this._instance||(this._instance=new H),this._instance}loadFromCache(){const e=h.instance().getConfigData(t.ShopInfoID),a=h.instance().getConfigData(t.PlankChooseID);a&&(this._unPlankChooseID=JSON.parse(a)),e?this._unlockIDSaveList=JSON.parse(e):(this._unlockIDSaveList.push("1001"),this._unPlankChooseID="1001",this._savePlankChooseID(this._unPlankChooseID),this._savePlankListToCache());for(let t=0;t<this._unlockIDSaveList.length;t++)this._unlockIDMap.has(this._unlockIDSaveList[t])||this._unlockIDMap.set(this._unlockIDSaveList[t],!0)}_savePlankListToCache(){const e=JSON.stringify(this._unlockIDSaveList);h.instance().setConfigData(t.ShopInfoID,e)}_savePlankChooseID(e){this._unPlankChooseID=e,h.instance().setConfigData(t.PlankChooseID,this._unPlankChooseID)}getUnlockCount(){return this._unlockIDSaveList.length}isAllUnlock(){return this._unlockIDSaveList.length>=9}isAllPlankUnlock(){return this._unlockIDSaveList.length>=t.MaxPlankSkin}unlockPlankByMoney(){let t=1500*this._unlockIDSaveList.length;if(z.instance().reduceMoney(t)){let t=this.getLockIDList(),a=Math.floor(Math.random()*t.length);this.unlockPlank(t[a]),e.dispatchEvent(r.SHOP_PLANK_BUY,t[a])}else P.ShowToast("金币数量不够~")}hasUnlock(t){return this._unlockIDMap.has(t)}unlockPlank(t){this._unlockIDMap.has(t)||(this._unlockIDSaveList.push(t),this._unlockIDMap.set(t,!0),this._savePlankListToCache(),this._savePlankChooseID(t))}choosePlank(t){this._unlockIDMap.has(t)&&(this._savePlankChooseID(t),e.dispatchEvent(r.SHOP_PLANK_CHOOSE,t))}getChoosePlankID(){return this._unPlankChooseID}getLockIDList(){let t=D.getPlanksRecord(),e=[];for(let a in t)this._unlockIDMap.has(a)||e.push(a);return e}}H._instance=null;const F=.15;class Y extends N{constructor(){super(),this._rotate_speed=.25,this.fingerMoveDistance_x=0,this.isMouseDown=!1,this._canPop=!0,this._isMoveArrival=!1,this._excitedTimer=-1,this._bigJump=!1,this._jumpInitSpeed=1.5,this._bigJmmpG=.0015}onAwake(){super.onAwake(),this.player=this.owner,this.trail=this.player.getChildByName("trail"),this._point=this.player.getChildByName("point"),this.blank_point=this.player.getChildByName("plank_point"),this.animator=this.player.getComponent(Laya.Animator),this.playerMove=new Laya.Vector3(0,0,this.forward_speed),this.curFrameTouchPoint_x=0,this.lastFrameTouchPoint_x=0,this.playerRotate=new Laya.Vector3(0,this._rotate_speed,0),Laya.stage.on(Laya.Event.MOUSE_DOWN,this,this.mouseDown),Laya.stage.on(Laya.Event.MOUSE_MOVE,this,this.mouseMove),Laya.stage.on(Laya.Event.MOUSE_UP,this,this.mouseUp),this.moveArrivalpointHandler=new Laya.Handler(this,this.moveArrivalpointCallback)}onStart(){super.onStart(),this.initRay(),this.playerInfo={name:"你",rank:1,player:!0},v.playerInfos.push(this.playerInfo),this._hideTrail()}onEnable(){e.register(r.MINI_GAME_START,this.onGameStart,this),e.register(r.MINI_GAME_END,this.onGameEnd,this),e.register(r.PLAYER_RELIFE,this.relifeCallback,this)}onDisable(){e.unRegister(r.MINI_GAME_START,this.onGameStart,this),e.unRegister(r.MINI_GAME_END,this.onGameEnd,this),e.unRegister(r.PLAYER_RELIFE,this.relifeCallback,this)}mouseDown(){o.gameState==a.Playing&&(this.isMouseDown||(this.isMouseDown=!0,this.curFrameTouchPoint_x=Laya.MouseManager.instance.mouseX,this.lastFrameTouchPoint_x=Laya.MouseManager.instance.mouseX))}mouseMove(){o.gameState==a.Playing&&this.isMouseDown&&(this.curFrameTouchPoint_x=Laya.MouseManager.instance.mouseX,this.fingerMoveDistance_x=this.curFrameTouchPoint_x-this.lastFrameTouchPoint_x,this.fingerMoveDistance_x>0?(this.playerRotate.setValue(0,-this._rotate_speed*Laya.timer.delta/1e3*this.fingerMoveDistance_x,0),this.player.transform.rotate(this.playerRotate,!0)):this.fingerMoveDistance_x<0&&(this.playerRotate.setValue(0,-this._rotate_speed*Laya.timer.delta/1e3*this.fingerMoveDistance_x,0),this.player.transform.rotate(this.playerRotate,!0)),this.lastFrameTouchPoint_x=this.curFrameTouchPoint_x)}mouseUp(){o.gameState==a.Playing&&this.isMouseDown&&(this.isMouseDown=!1)}onUpdate(){if(!(Laya.timer.delta>100)&&o.gameState==a.Playing)switch(this.rayCast(),this.animationState){case s.Planche:this._showTrail(),this._addSpeed(),this._moveForward(),this.player.transform.localPositionY<0&&(this.player.transform.localPositionY=0);break;case s.Carrying:case s.Running:this._hideTrail(),v.excited||(this.forward_speed=F,this.playerMove.setValue(0,0,this.forward_speed)),this._moveForward(),this.player.transform.localPositionY<0&&(this.player.transform.localPositionY=0);break;case s.Jump:if(this.playerMove.y-=this._decreaseDownspeed(),this._moveForward(),this.juageWaterDistance()){c.instance().playEffect("FallInWater"),this.clearExcited();let t=new Laya.Vector3(this.player.transform.position.x,-.5,this.player.transform.position.z);E.instance.loadEffect("fallEffect",-1,t).then(t=>{t.active=!0}),v.canRelife?(v.canRelife=!1,l.instance().PauseGame()):l.instance().DieGame()}break;case s.BigJump:if(this._bigJumpSpeed-=this._bigJmmpG*Laya.timer.delta,this.playerMove.y=this._bigJumpSpeed,this._moveForward(),this.juageWaterDistance()&&this.cube_count<=0){c.instance().playEffect("FallInWater"),this.clearExcited();let t=new Laya.Vector3(this.player.transform.position.x,-.5,this.player.transform.position.z);E.instance.loadEffect("fallEffect",-1,t).then(t=>{t.active=!0}),v.canRelife?(v.canRelife=!1,l.instance().PauseGame()):l.instance().DieGame()}}}init(t){super.init(t),T.instance.initPlayerData(this.player,this._point),this.changePlayerState(s.Idel),this.cube_count=0,this._canPop=!0}initCamera(t){this._camera=t,this.player=this.owner,this.player.addChild(t);let e=this.player.getChildByName("point");this._camera.transform.position=e.transform.position,this._camera.transform.lookAt(this.player.transform.position,Laya.Vector3.up)}_moveForward(){this.player.transform.translate(this.playerMove,!0)}_decreaseDownspeed(){return Laya.timer.delta/1e3*.8}changePlayerState(t){if(this.animationState!=t)switch(this._playAnimation(t),t){case s.Planche:case s.Carrying:case s.Running:this.playerMove.setValue(0,0,this.forward_speed);break;case s.Jump:this.playerMove.setValue(0,this.down_speed,this.forward_speed);break;case s.Idel:this.playerMove.setValue(0,0,0);break;case s.BigJump:this._bigJumpSpeed=this._jumpInitSpeed,this.playerMove.setValue(0,this._bigJumpSpeed,this.forward_speed)}}_playAnimation(t){this.animationState=t,t==s.Planche?this.animator.speed=1.5:this.animator.speed=1,t==s.BigJump&&(t=s.Carrying),this.animator.play(t)}onGameStart(){this.forward_speed=F,this.setHandPrefab(),this.startRay(),this._hideTrail(),v.excited&&this.startExcited(),this.changePlayerState(s.Running)}onGameEnd(){this.changePlayerState(s.Falling)}initRay(){this.ray_orign=this.player.transform.position.clone(),this.ray_down=new Laya.Ray(this.ray_orign,Laya.Vector3.down),this.outInfo=new Laya.HitResult}startRay(){this.isRayCast=!0}rayCast(){if(!this.physicsSimulation)return;if(!this.isRayCast)return;let t=this.player.transform.position;this.ray_orign.setValue(t.x,t.y+5,t.z),this.physicsSimulation.rayCast(this.ray_down,this.outInfo,20)&&this.refeshState(this.outInfo,this.animationState)}refeshState(t,e){if(!t||!t.succeeded)return;let a=this.outInfo.collider.owner.name;if(v.canRelife)switch(a){case"Turn_45_L":case"Turn_45_R":case"Turn_45_short_L":case"Turn_45_short_R":case"Cylinder":case"Stright":let t=this.outInfo.collider.owner;this.setRelifePart(t)}let i=t.point;switch(e){case s.Planche:switch(a){case"jumper":this._bigJump||(this._bigJump=!0,Laya.timer.once(1e3,this,()=>{this._bigJump=!1})),this.changePlayerState(s.BigJump);let t=this.outInfo.collider.owner.getComponent(G);t&&t.playJumpAni();break;case"arrival":this._moveArrivalPoint(this.outInfo.collider.owner);break;case"water":this.cube_count>0?(this._popPlankToRoad(),this.changePlayerState(s.Planche)):(this.changePlayerState(s.Jump),c.instance().playEffect("Jump"));break;case"Turn_45_L":case"Turn_45_R":case"Turn_45_short_L":case"Turn_45_short_R":case"Cylinder":case"Stright":case"plank":this.cube_count>0?this.changePlayerState(s.Carrying):this.changePlayerState(s.Running)}break;case s.Carrying:case s.Running:switch(a){case"jumper":this._bigJump||(this._bigJump=!0,Laya.timer.once(1e3,this,()=>{this._bigJump=!1})),this.changePlayerState(s.BigJump);let e=this.outInfo.collider.owner.getComponent(G);e&&e.playJumpAni();break;case"arrival":this._moveArrivalPoint(this.outInfo.collider.owner);break;case"water":this.cube_count>0?(this._popPlankToRoad(),this.changePlayerState(s.Planche)):(this.changePlayerState(s.Jump),c.instance().playEffect("Jump"));break;case"plank":console.log("plank"),this._addPlankToPlayer(),this.changePlayerState(s.Carrying),t.collider.owner.removeSelf()}break;case s.BigJump:if(this._bigJump)return;switch(a){case"water":if(this.player.transform.localPositionY<0&&this.cube_count>0)return this.player.transform.localPositionY=0,void this.changePlayerState(s.Planche);case"plank":case"Turn_45_L":case"Turn_45_R":case"Turn_45_short_L":case"Turn_45_short_R":case"Cylinder":case"Stright":if(this.juageRoadDistance())return this.cube_count>0?this.changePlayerState(s.Planche):this.changePlayerState(s.Running),void(this.player.transform.localPositionY<0&&(this.player.transform.localPositionY=0))}case s.Jump:switch(a){case"jumper":this._bigJump||(this._bigJump=!0,Laya.timer.once(1e3,this,()=>{this._bigJump=!1})),this.changePlayerState(s.BigJump);let t=this.outInfo.collider.owner.getComponent(G);t&&t.playJumpAni();break;case"arrvial":this.juageRoadDistance()&&(this.player.transform.localPositionY<1&&(this.player.transform.localPositionY=0),this._moveArrivalPoint(this.outInfo.collider.owner));break;case"plank":case"Turn_45_L":case"Turn_45_R":case"Turn_45_short_L":case"Turn_45_short_R":case"Cylinder":case"Stright":this.juageRoadDistance()&&(this.changePlayerState(s.Running),this.player.transform.localPositionY<0&&(this.player.transform.localPositionY=0));break;default:"plank_hand"==a.substring(0,10)&&this.juageBlankDistance(i)&&(console.log("judge blank road"),this.changePlayerState(s.Running))}}}juageWaterDistance(){return this.player.transform.localPositionY<=-2.3}juageRoadDistance(){return this.player.transform.localPositionY<=0}juageBlankDistance(t){return this.player.transform.localPositionY-t.y<=.05}_addPlankToPlayer(){this.cube_count++;let t=new Laya.Vector3;if(this.cube_array.length>0){let e=this.cube_array[this.cube_array.length-1];t.setValue(e.transform.position.x,e.transform.position.y+this.cube_height,e.transform.position.z)}else t=this.blank_point.transform.position.clone();let a=M.Spawn(this._plank_prefab,this.blank_point,t),i=a.getComponent(Laya.Animator);i.enabled=!0,i.play("blank_push"),a.getComponent(Laya.PhysicsCollider).enabled=!1;let s=a.transform.localPositionY+.2;Laya.Tween.from(a.transform,{localPositionY:s},.6),a.transform.rotation=this.blank_point.transform.rotation,this.cube_array.push(a),c.instance().playEffect("Collect"),P.vibrateShort(),e.dispatchEvent(r.PLAYER_PLANK_CHANGE,this.cube_count)}_addSpeed(){v.excited||this.forward_speed<F+.15&&(this.forward_speed+=Laya.timer.delta/1e3*.01,this.playerMove.setValue(0,0,this.forward_speed))}_popPlankToRoad(){if(!this._canPop)return;if(this.cube_array.length<=0)return;let t=this.cube_array.pop();this.cube_count--,M.RecycleObj(t,this._plank_prefab);let a=M.Spawn(this._plank_prefab,v.map,this.player.transform.position.clone());a.transform.rotation=this.player.transform.rotation.clone(),a.transform.setWorldLossyScale(Laya.Vector3.one),a.getComponent(Laya.Animator).enabled=!1,a.getComponent(Laya.PhysicsCollider).enabled=!0,this._canPop=!1,Laya.timer.once(200,this,()=>{this._canPop=!0}),c.instance().playEffect("Put"),P.vibrateShort(),e.dispatchEvent(r.PLAYER_PLANK_CHANGE,this.cube_count)}_clearPlank(){Laya.timer.frameLoop(1,this.player,()=>{if(this.cube_array.length<=0)return void Laya.timer.clearAll(this.player);let t=this.cube_array.pop();this.cube_count--,M.RecycleObj(t,this._plank_prefab)})}_throwPlank(t){this.cube_array.length<0?t&&t():this.cube_array.map((e,a)=>{let i=y.Random(-5,5),s=y.Random(3,10);Laya.Tween.to(e.transform,{localPositionX:i/2,localPositionY:y.Random(3,5),localPositionZ:s/2},500,Laya.Ease.quadIn,Laya.Handler.create(this,()=>{Laya.Tween.to(e.transform,{localPositionX:i,localPositionY:0,localPositionZ:s},500,Laya.Ease.quadIn,Laya.Handler.create(this,()=>{a===this.cube_array.length-1&&t&&t()}))}))})}_moveArrivalPoint(t){if(this._isMoveArrival)return;if(!t)return;this._throwPlank(()=>{this._clearPlank()}),this.clearExcited(),this.changePlayerState(s.Running);let e=v.getArrivalPos();this.player.transform.lookAt(e,Laya.Vector3.up,!1,!1),this._isMoveArrival=!0,this._clearMoveTween(),this.charactor_tween.to(this.player.transform,{localPositionX:e.x,localPositionZ:e.z},500,null,this.moveArrivalpointHandler),this._hideTrail()}_clearMoveTween(){this.charactor_tween.clear()}moveArrivalpointCallback(){o.gameState!=a.End&&(this.playerInfo.rank=v.rank,v.playRank=this.playerInfo.rank,v.rank++,l.instance().EndGame(),1===this.playerInfo.rank?(c.instance().playEffect("Win"),this.changePlayerState(s.Dance)):(c.instance().playEffect("Fail"),this.changePlayerState(s.Defeated)))}setRelifePart(t){this._relifePart?this._relifePart!=t&&(this._relifePart=t):this._relifePart=t}relifeCallback(){if(this._relifePart){let t=this._relifePart.transform.position.clone();this.player.transform.position=new Laya.Vector3(t.x,0,t.z);let e=this._relifePart.getChildAt(0);this.player.transform.lookAt(e.transform.position.clone(),Laya.Vector3.up,!1,!1),l.instance().ResumeGame(),this._hideTrail()}}setHandPrefab(){let t=H.instance().getChoosePlankID(),e=D.getPlanksRecord(t);this._plank_prefab=e.Prefab}_showTrail(){this.trail.active||(this.trail.active=!0)}_hideTrail(){v.excited||this.trail.active&&(this.trail.active=!1)}startExcited(){this._showTrail(),this.forward_speed=F+.1,this._excitedTimer=setTimeout(()=>{this.clearExcited()},1e4)}clearExcited(){v.excited&&(this.forward_speed=F,v.excited=!1,clearTimeout(this._excitedTimer),this._hideTrail())}}class W extends k{onAwake(){super.onAwake(),this._water=this.owner,this._mat=this._water.meshRenderer.material,e.register(r.CHANGE_WATER,this.SetWaterTexture,this)}onDestroy(){e.unRegister(r.CHANGE_WATER,this.SetWaterTexture,this)}init(t){super.init(t)}onUpdate(){Laya.timer.delta>=100||this.WaterFloat()}WaterFloat(){if(!this._mat)return;let t=this._mat.tilingOffsetY,e=this._mat.tilingOffsetX,a=Laya.timer.delta/1e3;this._mat.tilingOffsetY+=2e-4*(Math.sin(3.5*e+.35*a)+Math.sin(4.8*e+1.05*a)+Math.sin(7.3*e+.45*a))/3,this._mat.tilingOffsetX+=.0024*(Math.sin(4*t+.5*a)+Math.sin(6.8*t+.75*a)+Math.sin(11.3*t+.2*a))/3,this._mat.tilingOffsetY+=.0024*(Math.sin(4.2*e+.64*a)+Math.sin(6.3*e+1.65*a)+Math.sin(8.2*e+.45*a))/3}SetWaterTexture(t){this._mat.albedoTexture=v.waterTex_map.get(t.toString())}}var j,J=Laya.Vector3,q=[new J,new J,new J,new J,new J,new J,new J,new J],X=new J;new J,new J,new J,new J,new J,new J,new J,new J,new J,new J;class K{constructor(t,e){this.min=void 0!==t?t:new J(1/0,1/0,1/0),this.max=void 0!==e?e:new J(-1/0,-1/0,-1/0)}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){for(var e=1/0,a=1/0,i=1/0,s=-1/0,n=-1/0,r=-1/0,o=0,h=t.length;o<h;o+=3){var l=t[o],c=t[o+1],d=t[o+2];l<e&&(e=l),c<a&&(a=c),d<i&&(i=d),l>s&&(s=l),c>n&&(n=c),d>r&&(r=d)}return this.min.set(e,a,i),this.max.set(s,n,r),this}setFromPoints(t){this.makeEmpty();for(var e=0,a=t.length;e<a;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){var a=X.copy(e).mult(.5);return this.min.copy(t).vsub(a,this.min),this.max.copy(t).vadd(a,this.max),this}setFromObject(t){return this.makeEmpty(),this.expandByObject(t)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}clone(){return(new K).copy(this)}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){t=t||new J;return this.isEmpty()?t.set(0,0,0):(this.min.vadd(this.max,t),t.mult(.5,t)),t}getSize(t){t=t||new J;return this.isEmpty()?t.set(0,0,0):this.max.vsub(this.min,t),t}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.vsub(t,this.min),this.max.vadd(t,this.max),this}expandByScalar(t){return this.min.x-=t,this.min.y-=t,this.min.z-=t,this.max.x+=t,this.max.y+=t,this.max.z+=t,this}expandByObject(t){if(t instanceof Laya.MeshSprite3D){let e=t;e.meshFilter.sharedMesh.calculateBounds(),j||(j=new K),j.set(e.meshFilter.sharedMesh.bounds.getMin(),e.meshFilter.sharedMesh.bounds.getMax()),j.applyMatrix4(t.transform.worldMatrix),this.union(j)}var e=[];for(let a=0;a<t.numChildren;a++)e.push(t.getChildAt(a));for(var a=0,i=e.length;a<i;a++)this.expandByObject(e[a]);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return(e=e||new J).set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z)),e}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}applyMatrix4(t){return this.isEmpty()?this:(q[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),q[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),q[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),q[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),q[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),q[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),q[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),q[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(q),this)}union(t){return this.min=this.min.min(t.min),this.max=this.max.max(t.max),this}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}}var Z,Q=Laya.Handler,$=Laya.Vector3,et=Laya.Quaternion;class at{constructor(){this.mapBox=new K,this.water_index=0,this.entitys={},this.isGameReady=!1}static instance(){return this._instance||(this._instance=new at),this._instance}loadLevel(t){return v.name_array=v.RandomName(),new Promise(a=>{Promise.all([this.loadScene3D(o.scenePath),this.loadConfig(t),this.loadSounds(),this.loadRoadTextures(),this.loadWaterTextures()]).then(a=>{if(this.data=a[1],this.data.objs.sort((t,e)=>t.transform[14]-e.transform[14]),this.camera=this.scene_3d.getChildByName("Main Camera"),this.camera.addComponent(T),this.camera.enableHDR=!1,this.map=new Laya.Sprite3D("Map",!0),this.map.transform.position=$.zero,this.map.transform.setWorldLossyScale($.one),this.map.transform.rotation=et.DEFAULT,this.scene_3d.addChild(this.map),Laya.stage.getChildByName("root").addChildAt(this.scene_3d,0),v.scene3d=this.scene_3d,v.map=this.map,this.road_mat){let e=(t-1)%7;v.roadTex_map.has(e.toString())&&(this.road_mat.albedoTexture=v.roadTex_map.get(e.toString()))}l.instance().getSceneLevel()>15&&l.instance().getSceneLevel()<30?e.dispatchEvent(r.CHANGE_WATER,0):l.instance().getSceneLevel()>=30&&e.dispatchEvent(r.CHANGE_WATER,1)}).then(()=>{this.init().then(()=>{this.isGameReady=!0,console.log("game ready"),a()})})})}loadRoadTextures(){return new Promise(t=>{let e=[];for(let t=0;t<7;t++)e.push(new Promise(e=>{Laya.Texture2D.load(o.roadTexPath+t+".png",Q.create(null,a=>{v.roadTex_map.has(t.toString())||v.roadTex_map.set(t.toString(),a),e()}))}));Promise.all(e).then(()=>{Laya.timer.frameOnce(1,null,()=>{t()})})})}loadWaterTextures(){return new Promise(t=>{let e=[];for(let t=0;t<2;t++)e.push(new Promise(e=>{Laya.Texture2D.load(o.waterTexPath+t+".png",Q.create(null,a=>{v.waterTex_map.has(t.toString())||v.waterTex_map.set(t.toString(),a),e()}))}));Promise.all(e).then(()=>{Laya.timer.frameOnce(1,null,()=>{t()})})})}loadScene3D(t){return new Promise(e=>{Laya.loader.create(t,Laya.Handler.create(this,()=>{this.scene_3d=Laya.loader.getRes(t),e(this.scene_3d)}))})}loadConfig(t){let e=o.levelRoot+"Lv_"+t+".json";return new Promise(t=>{let a=(new Date).getTime();Laya.loader.load(e,Q.create(null,i=>{console.log("load:",e,(new Date).getTime()-a,"ms"),t(i)}),null,Laya.Loader.JSON).once(Laya.Event.ERROR,null,t=>{console.log("load config error!",t,"return home page")})})}loadSounds(){return new Promise(t=>{let e=[];for(let t=0;t<o.sounds.length;t++){let a=o.sounds[t];e.push(new Promise(t=>{Laya.loader.create(o.soundPath+a,Q.create(null,()=>{t()}))}))}Promise.all(e).then(()=>{Laya.timer.frameOnce(1,null,t)})})}init(){return new Promise(t=>{this.mapBox.makeEmpty(),this.loadPrefabs().then(()=>{let e=[this.loadObjs()];Promise.all(e).then(()=>{this.compileShaders(),this.onGameReady(),t()})})})}onGameReady(){console.log("ongameReady+++++++++++++++++++"),this.isGameReady||(this.isGameReady=!0),S.instance.on(S.on_clear_scene,this,this.clearScene)}compileShaders(){Laya.Shader3D.compileShaderByDefineNames("BLINNPHONG",0,0,["GPU_INSTANCE","DIRECTIONLIGHT","UV","UV1","SHADOWMAP_PSSM1","CASTSHADOW","FOG","SHADOWMAP_PCF3"]),Laya.Shader3D.compileShaderByDefineNames("BLINNPHONG",0,0,["GPU_INSTANCE","DIRECTIONLIGHT","UV","SHADOWMAP_PSSM1","FOG","SHADOWMAP_PCF3"]),Laya.Shader3D.compileShaderByDefineNames("BLINNPHONG",0,0,["GPU_INSTANCE","DIRECTIONLIGHT","UV","SHADOWMAP_PSSM1","CASTSHADOW","FOG","SHADOWMAP_PCF3"]),Laya.Shader3D.compileShaderByDefineNames("BLINNPHONG",0,0,["DIRECTIONLIGHT","UV","UV1","SHADOWMAP_PSSM1","FOG","SHADOWMAP_PCF3"]),Laya.Shader3D.compileShaderByDefineNames("BLINNPHONG",0,0,["DIRECTIONLIGHT","UV","COLOR","SHADOWMAP_PSSM1","CASTSHADOW","FOG","SHADOWMAP_PCF3"]),Laya.Shader3D.compileShaderByDefineNames("BLINNPHONG",0,0,["GPU_INSTANCE","DIRECTIONLIGHT","UV","COLOR","SHADOWMAP_PSSM1","FOG","SHADOWMAP_PCF3"]),Laya.Shader3D.compileShaderByDefineNames("BLINNPHONG",0,0,["DIRECTIONLIGHT","UV","COLOR","SHADOWMAP_PSSM1","FOG","SHADOWMAP_PCF3"]),Laya.Shader3D.compileShaderByDefineNames("BLINNPHONG",0,0,["GPU_INSTANCE","DIRECTIONLIGHT","UV","UV1","SHADOWMAP_PSSM1","FOG","SHADOWMAP_PCF3"]),Laya.Shader3D.compileShaderByDefineNames("BLINNPHONG",0,0,["GPU_INSTANCE","DIRECTIONLIGHT","UV","COLOR","FOG"]),Laya.Shader3D.compileShaderByDefineNames("PARTICLESHURIKEN",0,0,["DIFFUSEMAP","FOG","ADDTIVEFOG","STRETCHEDBILLBOARD","COLOROVERLIFETIME","SIZEOVERLIFETIMECURVE","SHAPE","TINTCOLOR"]),Laya.Shader3D.compileShaderByDefineNames("PARTICLESHURIKEN",0,0,["DIFFUSEMAP","FOG","SPHERHBILLBOARD","COLOROVERLIFETIME","ROTATIONOVERLIFETIMERANDOMCONSTANTS","SIZEOVERLIFETIMECURVE","ROTATIONOVERLIFETIME","TEXTURESHEETANIMATIONCURVE","SHAPE","TINTCOLOR"]),Laya.Shader3D.compileShaderByDefineNames("PARTICLESHURIKEN",0,0,["DIFFUSEMAP","FOG","SPHERHBILLBOARD","ROTATIONOVERLIFETIMERANDOMCONSTANTS","SIZEOVERLIFETIMECURVE","ROTATIONOVERLIFETIMESEPERATE","SHAPE","TINTCOLOR"]),Laya.Shader3D.compileShaderByDefineNames("PARTICLESHURIKEN",0,0,["DIFFUSEMAP","FOG","SPHERHBILLBOARD","COLOROVERLIFETIME","ROTATIONOVERLIFETIMERANDOMCONSTANTS","SIZEOVERLIFETIMECURVE","ROTATIONOVERLIFETIME","SHAPE","TINTCOLOR"]),Laya.Shader3D.compileShaderByDefineNames("PARTICLESHURIKEN",0,0,["DIFFUSEMAP","FOG","ADDTIVEFOG","SPHERHBILLBOARD","COLOROVERLIFETIME","ROTATIONOVERLIFETIMERANDOMCONSTANTS","SIZEOVERLIFETIMECURVE","ROTATIONOVERLIFETIME","TEXTURESHEETANIMATIONCURVE","SHAPE","TINTCOLOR"]),Laya.Shader3D.compileShaderByDefineNames("BLINNPHONG",0,0,["DIFFUSEMAP","DIRECTIONLIGHT","UV","SHADOWMAP_PSSM1","FOG","SHADOWMAP_PCF3"]),Laya.Shader3D.compileShaderByDefineNames("BLINNPHONG",0,0,["GPU_INSTANCE","DIRECTIONLIGHT","UV","UV1","FOG"]),Laya.Shader3D.compileShaderByDefineNames("BLINNPHONG",0,0,["GPU_INSTANCE","DIRECTIONLIGHT","UV","FOG"]),Laya.Shader3D.compileShaderByDefineNames("BLINNPHONG",0,0,["GPU_INSTANCE","DIFFUSEMAP","DIRECTIONLIGHT","UV","TILINGOFFSET","FOG"]),Laya.Shader3D.compileShaderByDefineNames("BLINNPHONG",0,0,["DIRECTIONLIGHT","UV","UV1","RECEIVESHADOW","FOG"]),Laya.Shader3D.compileShaderByDefineNames("BLINNPHONG",0,0,["DIFFUSEMAP","DIRECTIONLIGHT","UV","UV1","RECEIVESHADOW","TILINGOFFSET","FOG"]),Laya.Shader3D.compileShaderByDefineNames("BLINNPHONG",0,0,["GPU_INSTANCE","DIFFUSEMAP","DIRECTIONLIGHT","UV","UV1","RECEIVESHADOW","TILINGOFFSET","FOG"])}loadPrefabs(){return new Promise(t=>{let e=[];for(let t=0;t<o.preload.length;t++){let a=o.preload[t];e.push(new Promise(t=>{Laya.Sprite3D.load(o.prefabRoot+a,Q.create(null,e=>{this.scene_3d.addChild(e),"Turn_45_L.lh"==a&&this.setRoadMat(e),e.transform.position=new Laya.Vector3(0,0,0),Laya.timer.frameOnce(1,null,e=>{this.scene_3d.removeChild(e),t()},[e])}))}))}Promise.all(e).then(()=>{Laya.timer.frameOnce(1,null,t)})})}setRoadMat(t){let e=t;this.road_mat=e.meshRenderer.sharedMaterial}loadObjs(){return new Promise(t=>{this.data.objs&&this.data.objs.map(t=>{let e=this.loadObj(t);this.mapBox.expandByObject(e.owner)}),t()})}loadObj(t){let e=this.entitys[t.id];if(e)return e;let a=t.tag,i=o.prefabRoot+a+".lh",s=Laya.loader.getRes(i),n=Laya.Sprite3D.instantiate(s,this.map);switch(t.tag){case"water":e=n.addComponent(W);break;case"character_base":v.player=n,(e=n.addComponent(Y)).initScene3d(this.scene_3d);break;case"enemy":(e=n.addComponent(O)).initScene3d(this.scene_3d);break;case"arrival":e=n.addComponent(R);break;case"jumper":e=n.addComponent(G);break;default:e=n.addComponent(k)}return e.init(t),this.entitys[t.id]=e,e}loadSkyMat(){let t=o.prefabRoot+"Assets/Materialss/SkyMat.lmat";return new Promise(e=>{Laya.SkyBoxMaterial.load(t,Laya.Handler.create(null,t=>{this.sky_mat=t,e()}))})}loadSkyCube(){let t=o.prefabRoot+"Assets/Materialss/skyCubeMap.ltc";return new Promise(e=>{Laya.TextureCube.load(t,Laya.Handler.create(null,t=>{this.sky_mat.textureCube=t,e()}))})}clearScene(){Laya.timer.clearAll(this),Laya.timer.clearAll(null),E.instance.clear(),this.data=null,v.scene3d.removeSelf(),v.scene3d.destroy(),v.scene3d=null,v.resetData(),this.entitys={},S.instance.offAll(),Laya.stage.offAll(),o.gameState=a.None}}at._instance=null,function(t){t[t.PANEL=0]="PANEL",t[t.POPUP=1]="POPUP",t[t.TIP=2]="TIP",t[t.EFFECT=3]="EFFECT",t[t.TUTORIAL=4]="TUTORIAL"}(Z||(Z={}));class it extends Laya.Script{constructor(){super(...arguments),this.type=Z.PANEL,this.isVisible=!1,this.onShowEnd=null}show(...t){switch(this.isVisible=!0,this.type){case Z.PANEL:case Z.POPUP:let t=this.owner;t.scaleX=.8,t.scaleY=.8,Laya.Tween.to(t,{scaleX:1.1,scaleY:1.1},200,null,Laya.Handler.create(this,()=>{Laya.Tween.to(t,{scaleX:1,scaleY:1},100,null,Laya.Handler.create(this,()=>{this.onShowEnd&&this.onShowEnd()}))}))}}hide(){this.isVisible=!1}}class st extends Laya.Script{constructor(){super(),this.dictPanelMap=new Map,st.instance=this}onAwake(){c.instance().loadFromCache(),H.instance().loadFromCache(),this._panelLayer=this.owner.getChildByName("PanelLayer"),this._popupLayer=this.owner.getChildByName("PopupLayer"),this._tipLayer=this.owner.getChildByName("TipLayer"),this._effectLayer=this.owner.getChildByName("EffectLayer")}onStart(){let e=Math.floor(l.instance().getSceneLevel()/3)+1;e=e%7==0?1:e%7,this.showPage(t.UIPage.loading),at.instance().loadLevel(e).then(()=>{this.hidePage(t.UIPage.loading,()=>{this.showPage(t.UIPage.home,null),this.showPage(t.UIPage.info,null,!0,!0,!0),P.loadVideoRewardAd()})})}hidePage(t,e){if(this.dictPanelMap.has(t)){const a=this.dictPanelMap.get(t);a.parent&&a.parent.active&&(a.parent.active=!1),a.removeSelf();const i=a.getComponent(it);i&&i.hide&&i.hide.apply(i),e&&e()}}showPage(t,e,...a){if(this.dictPanelMap.has(t)){const i=this.dictPanelMap.get(t),s=i.getComponent(it),n=this.getParent(s.type);return n.addChild(i),n.active=!0,s&&s.show&&s.show.apply(s,a),void(e&&e())}let i=this.getPrefab(t).create();this.dictPanelMap.set(t,i);const s=i.getComponent(it),n=this.getParent(s.type);n.active=!0,n.addChild(i),s&&s.show&&s.show.apply(s,a),e&&e()}hideAll(){this.dictPanelMap.forEach(t=>{const e=t.getComponent(it);e&&e.isVisible&&this.hidePage(t.name)})}getParent(t){switch(t){case Z.PANEL:return this._panelLayer;case Z.POPUP:return this._popupLayer;case Z.TIP:return this._tipLayer;case Z.EFFECT:return this._effectLayer}}getPrefab(e){switch(e){case t.UIPage.home:return this.homePage;case t.UIPage.playing:return this.playingPage;case t.UIPage.relife:return this.relifePage;case t.UIPage.result:return this.resultPage;case t.UIPage.loading:return this.loadingPage;case t.UIPage.shop:return this.shopPage;case t.UIPage.info:return this.infoPage;case t.UIPage.setting:return this.settingPage;case t.UIPage.coinEffect:return this.coinEffectPage}}getCoinPrefab(){return this.coin}}st.instance=null;class nt{static isToday(t){return new Date(t).toLocaleDateString()==(new Date).toLocaleDateString()}static isSameDay(t,e){return new Date(t).toLocaleTimeString()==new Date(e).toLocaleDateString()}static GetNextDay(t){let e=new Date(t).toLocaleDateString(),a=new Date(e).getTime()+864e5;return new Date(a)}}class rt{static start(t,e,a,i=-1,s=null,...n){let r={target:t,callback:e,interval:a,repeatTimes:i,endCallback:s,curTimes:0,args:n};e&&e.apply||console.trace();let o={timerId:0,timerObj:r};return o.timerId=setInterval(this._getIntervalCallback(o).bind(this),a),this._add(o),o.timerId}static clear(t){if("number"!=typeof t)if(t instanceof Array)for(;t.length;){let e=t.pop();"number"==typeof e&&this._clear(e)}else;else this._clear(t)}static _clear(t){if((t>>=0)<0)return;clearInterval(t),this._has(t)&&this._timerMap.delete(t)}static _add(t){this._timerMap=this._timerMap||new Map,this._timerMap.set(t.timerId,t)}static _has(t){return!((t>>=0)<0||!this._timerMap||!this._timerMap.has(t))&&this._timerMap.get(t)}static _getIntervalCallback(t){return function(){let e=t.timerObj;e.curTimes++,e.callback.call(e.target,e.args),e.repeatTimes>0&&e.curTimes>=e.repeatTimes&&(this._clear(t.timerId),e.endCallback&&e.endCallback.call(e.target))}}}rt._timerMap=null;class ot{constructor(){this._dailyTick=-1,this._dailyTimer=-1,this._leftTime=-1}static instance(){return this._instance||(this._instance=new ot),this._instance}loadFromCache(){const e=h.instance().getConfigData(t.DailyTick);e&&(this._dailyTick=JSON.parse(e));let a=(new Date).getTime();a>this._dailyTick&&(this._dailyTick=nt.GetNextDay(a).getTime(),this.saveDailyTicktoCache(),d.instance().resetHRecord()),this._startTimer()}saveDailyTicktoCache(){const e=JSON.stringify(this._dailyTick);h.instance().setConfigData(t.DailyTick,e)}_startTimer(){rt.clear(this._dailyTimer);let t=(new Date).getTime();this._leftTime=nt.GetNextDay(new Date).getTime()-t,this._dailyTimer=rt.start(null,this._refreshDaily.bind(this),this._leftTime,1)}_refreshDaily(){let t=(new Date).getTime();this._dailyTick=nt.GetNextDay(t).getTime(),this.saveDailyTicktoCache(),d.instance().resetHRecord(),this._startTimer()}}ot._instance=null;const ht=490;class lt extends Laya.Script{constructor(){super(...arguments),this._isSubload=!1,this._enterGame=!1,this._subTask=null}onAwake(){this.uiBox=this.owner.getChildAt(0),this.progress=this.owner.getChildByName("progressBack").getChildByName("progress"),this.progress.width=1}onStart(){h.instance().init(),z.instance().loadFromCache(),l.instance().loadLevelFromCache(),d.instance().loadFromCache(),P.initGameRecorder(),ot.instance().loadFromCache(),P.passiveShare(),P.createVideoRewardAd(),this.loadSubPackages()}onUpdate(){Laya.timer.delta>100||this._enterGame||this._refreshProgress()}loadSubPackages(){P.loadSubpackage("sub1",()=>{this.subCallback()}),this._subTask&&this._subTask.onProgressUpdate(t=>{this._subProgress=t.progress})}_refreshProgress(){this.progress.width<=.9*ht?this._subTask?this.progress.width=.9*this._subProgress*ht:this.progress.width+=Laya.timer.delta/1e3*.6*ht:(this._isSubload&&(this.progress.width+=Laya.timer.delta/1e3*.3*ht),this.progress.width>=ht&&(this.progress.width=ht),this.progress.width>=ht&&this.enterGame())}subCallback(){this._isSubload||(Laya.Scene.open("Scenes/Game.scene",!1),this._isSubload=!0,P.loadSubpackage("sub2",null))}enterGame(){!this._enterGame&&at.instance().isGameReady&&(console.log("enter game!"),Laya.Scene.close("Scenes/Start.scene"),this._enterGame=!0)}}class ct extends it{constructor(){super(),this._progressItems=[],this.onShowEnd=this.showEndCallBack,this._startPosY=0,ct.instance=this}onAwake(){this._info=this.owner,this._uiBox=this._info.getChildAt(0),this._levelInfoBack=this._uiBox.getChildByName("LevelInfoBack"),this._levelProgressBack=this._levelInfoBack.getChildByName("LevelProgressBack");for(let t=0;t<this._levelProgressBack.numChildren;t++)this._progressItems[t]=this._levelProgressBack.getChildAt(t);this._coinInfo=this._uiBox.getChildByName("CoinInfo"),this._curLabel=this._levelInfoBack.getChildByName("CurBack").getChildAt(0),this._nextLabel=this._levelInfoBack.getChildByName("NextBack").getChildAt(0),this._titleBack=this._uiBox.getChildByName("TitleBack"),this._titleImage=this._titleBack.getChildByName("Title"),this._titleSeal=this._titleBack.getChildByName("Seal"),e.register(r.CHANGE_TITLE,this._titleChanged,this),this._startPosY=this._titleBack.y}onStart(){P.isLongHeight()&&(this._titleBack.y=this._startPosY+150)}show(t,e,a,i=!1){super.show(),z.instance().setPlayerTitle(),this._refreshTitle(a),this._refreshCoinUI(t),this._refreshLevelInfoUI(e,i)}hide(){super.hide(),Laya.Tween.clearAll(this._titleSeal),Laya.Tween.clearAll(this._titleImage),this._titleSeal.scale(1,1),this._titleImage.scale(1,1)}getCoinInfoPos(){return new Laya.Vector2(this._coinInfo.x,this._coinInfo.y)}_refreshCoinUI(t){this._coinInfo.visible=t}_refreshLevelInfoUI(t,e){if(this._levelInfoBack.visible=t,t){let t=l.instance().getSceneLevel(),a=Math.floor(t/3)+1,i=e?t%3+1:t%3;this._curLabel.text=a.toString(),this._nextLabel.text=(a+1).toString();for(let t=0;t<this._progressItems.length;t++)this._progressItems[t].visible=t<i}}_refreshTitle(t){if(!t)return void(this._titleBack.visible=!1);switch(this._titleBack.visible=!0,z.instance().getPlayerTitle()){case U.QINGTONG:this._titleImage.skin="textures/title1.png";break;case U.BAIYING:this._titleImage.skin="textures/title2.png";break;case U.HUANGJING:this._titleImage.skin="textures/title3.png";break;case U.BOJING:this._titleImage.skin="textures/title4.png";break;case U.ZHUANSHI:this._titleImage.skin="textures/title5.png";break;case U.DASHI:this._titleImage.skin="textures/title6.png";break;case U.WANGZHE:this._titleImage.skin="textures/title7.png"}}_titleChanged(){Laya.Tween.clearAll(this._titleSeal),Laya.Tween.clearAll(this._titleImage),this._titleImage.scale(1.2,1.2),Laya.Tween.to(this._titleImage,{scaleX:1,scaleY:1},150,Laya.Ease.backIn,null,450),this._titleSeal.scale(2.5,2.5),Laya.Tween.to(this._titleSeal,{scaleX:1,scaleY:1},300,Laya.Ease.backIn,Laya.Handler.create(this,()=>{c.instance().playEffect("Seal")}),450)}showEndCallBack(){}}ct.instance=null;class dt{constructor(t,e,a,i,s,n){this.parent=t,this.count=e,this.startPos=a,this.prefab=i,this.endPos=s,this.cb=n}createEffect(){return new Promise(t=>{let e=[];for(let t=1;t<=this.count;t++){let a=400/this.count*t*Math.PI/180,i=this.startPos.x+y.Random(150,200)*Math.cos(a),s=this.startPos.y+y.Random(150,200)*Math.sin(a),n=M.getCoin(this.prefab,this.parent);n.active=!0,n.x=this.startPos.x,n.y=this.startPos.y,n.visible=!0,n.scale(.65,.65);let r=y.Random(.2,.5)/1.5,o=y.Random(.8,1.1)/1.5;e.push(new Promise(t=>{Laya.Tween.to(n,{x:i,y:s},1e3*r,null,Laya.Handler.create(this,()=>{Laya.Tween.to(n,{x:this.endPos.x,y:this.endPos.y},1e3*o,Laya.Ease.cubicIn,Laya.Handler.create(this,()=>{this.count%2==0&&c.instance().playEffect("Reward"),n.scale(.9,.9),Laya.Tween.to(n,{scaleX:1,scaleY:1},50,null,Laya.Handler.create(this,()=>{Laya.Tween.to(n,{scaleX:.9,scaleY:.9},50,null,Laya.Handler.create(this,()=>{M.putCoin(n),t()}))}))}))}))}))}Promise.all(e).then(()=>{this.cb&&this.cb(),t()})})}}var yt;!function(t){t[t.Coin=1]="Coin",t[t.Heat=2]="Heat",t[t.Micro=3]="Micro",t[t.DropCoin=4]="DropCoin"}(yt||(yt={}));class ut extends it{constructor(){super(...arguments),this.type=Z.EFFECT,this._effectCount=0}show(t,e,a,i){let s=e,n=a;this.CreateMultiplyFlyEffect(n,t,s,i)}hide(){}CreateMultiplyFlyEffect(e,a,i=null,s){this._effectCount++;let n=ct.instance.getCoinInfoPos(),r=this.owner.getChildAt(0);this.effect=new dt(r,e,a,s,n,i),this.effect.createEffect().then(()=>{this._effectCount--,this._effectCount<=0&&(st.instance.hidePage(t.UIPage.coinEffect),this._effectCount=0)})}getRandom(t=0,e=1){return t+(e-t)*Math.random()}}class pt extends it{constructor(){super(),this.type=Z.PANEL,pt.instance=this}onAwake(){this._homeUI=this.owner,this._uiBox=this._homeUI.getChildAt(0),this._startBtn=this._uiBox.getChildByName("StartBtn"),this._shareBtn=this._uiBox.getChildByName("ShareBtn"),this._shopBtn=this._uiBox.getChildByName("ShopBtn"),this._settingBtn=this._uiBox.getChildByName("SettingBtn"),this._videoBtn=this._uiBox.getChildByName("VideoBtn"),this._startBtn.on(Laya.Event.CLICK,this,this.startGame),this._shopBtn.on(Laya.Event.CLICK,this,this.showShopView),this._shareBtn.on(Laya.Event.CLICK,this,this.ShareGame),this._settingBtn.on(Laya.Event.CLICK,this,this.showSettingPage),this._videoBtn.on(Laya.Event.CLICK,this,this.addSpeed),this._startPosY=this._startBtn.y}onStart(){}show(...t){super.show(),P.showBanner(),Laya.Browser.window.tt&&(this._shareBtn.visible=!1),P.isLongHeight()&&(this._startBtn.y=this._startPosY+150)}hide(){super.hide(),P.hideBanner()}onEnable(){}onDisable(){}startGame(){o.gameState!=a.Playing&&(c.instance().playEffect("Click"),l.instance().StartGame(),st.instance.hidePage(t.UIPage.info),st.instance.hidePage(t.UIPage.home,()=>{st.instance.showPage(t.UIPage.playing),P.startGameRecord()}))}showShopView(){c.instance().playEffect("Click"),st.instance.hidePage(t.UIPage.home,()=>{st.instance.showPage(t.UIPage.shop)})}ShareGame(){c.instance().playEffect("Click"),P.share(!1,()=>{P.ShowToast("分享成功，获得100金币！"),z.instance().addMoney(100,!0);let a=new Laya.Vector2(this._shareBtn.x,this._shareBtn.y);st.instance.showPage(t.UIPage.coinEffect,null,a,()=>{e.dispatchEvent(r.ADD_MOENY)},10,st.instance.getCoinPrefab())},()=>{P.ShowToast("分享失败，请分享到不同的群")})}showSettingPage(){c.instance().playEffect("Click"),st.instance.showPage(t.UIPage.setting)}addSpeed(){c.instance().playEffect("Click"),P.showVideoRewardAd(()=>{v.excited=!0,P.ShowToast("恭喜获得开局10秒加速~")},()=>{P.ShowToast("只有观看完毕才可获取奖励哦~")})}}pt.instance=null;class mt extends Laya.Script{onAwake(){this._moneyBack=this.owner,this._moenyLabel=this._moneyBack.getChildAt(0)}onEnable(){this.refreshMoneyLabel(),e.register(r.REDUCE_MOENY,this.refreshMoneyLabel,this),e.register(r.ADD_MOENY,this.refreshMoneyLabel,this)}onDisable(){e.unRegister(r.REDUCE_MOENY,this.refreshMoneyLabel,this),e.unRegister(r.ADD_MOENY,this.refreshMoneyLabel,this)}refreshMoneyLabel(){this._moenyLabel.text=z.instance().playerInfo.money.toString()}}class _t extends it{constructor(){super(...arguments),this.type=Z.TIP,this._startRotate=!1}onAwake(){this._loading=this.owner,this._uiBox=this._loading.getChildAt(0),this._round=this._uiBox.getChildByName("Round")}onUpdate(){Laya.timer.delta>100||this._startRotate&&(this._round.rotation+=20)}show(){super.show(),this._startRotate=!0}hide(){super.hide(),this._startRotate=!1,this._round.rotation=0}}class gt extends Laya.Script{constructor(){super(...arguments),this._unlock=!1}onAwake(){this._backBtn=this.owner,this._icon=this._backBtn.getChildByName("icon"),this._lock=this._backBtn.getChildByName("lock"),this._check=this._backBtn.getChildByName("check"),this._id&&this._refreshItem(this._id)}onStart(){}setData(t){t&&(this._id=t,this._backBtn&&this._refreshItem(t))}_refreshItem(t){this._backBtn.on(Laya.Event.CLICK,this,this._chooseSkin);let e=D.getPlanksRecord(t);if(this._unlock=H.instance().hasUnlock(t),this._unlock){this._lock.visible=!1,H.instance().getChoosePlankID()==t?(this._backBtn.skin="textures/grid_green.png",this._check.visible=!0):(this._backBtn.skin="textures/grid_blue.png",this._check.visible=!1);let a=`planks/${e.SpriteName}.png`;return this._icon.skin=a,void(this._icon.visible=!0)}this._backBtn.skin="textures/grid_grey.png",this._icon.visible=!1,this._check.visible=!1,this._lock.visible=!0}_chooseSkin(){console.log("choose skin",this._id),this._unlock&&H.instance().choosePlank(this._id)}}class ft extends it{constructor(){super(),this.type=Z.PANEL,ft.instance=this}onAwake(){this._playing=this.owner,this._uiBox=this._playing.getChildAt(0),this._moveArrow=this._uiBox.getChildByName("MoveArrow")}onEnable(){this._uiBox.on(Laya.Event.MOUSE_DOWN,this,this.hideMoveArrow.bind(this)),e.register(r.MINI_GAME_RELIFE,this.showRelifeUI,this),e.register(r.MINI_GAME_DIE,this.showDieUI,this),e.register(r.MINI_GAME_END,this.showResultUI,this)}onDisable(){this._uiBox.offAll(),e.unRegister(r.MINI_GAME_RELIFE,this.showRelifeUI,this),e.unRegister(r.MINI_GAME_DIE,this.showDieUI,this),e.unRegister(r.MINI_GAME_END,this.showResultUI,this)}show(...t){super.show(),this.showMoveArrow()}hide(){super.hide(),this.hideMoveArrow()}showMoveArrow(){this._moveArrow.x=this._uiBox.width/2,this._moveArrow.y=this._uiBox.height/3*2,this._moveArrow.visible=!0}hideMoveArrow(){this._moveArrow.visible&&(this._moveArrow.visible=!1)}showRelifeUI(){st.instance.hidePage(t.UIPage.playing,()=>{st.instance.showPage(t.UIPage.relife,null,0)})}showDieUI(){st.instance.hidePage(t.UIPage.playing,()=>{st.instance.showPage(t.UIPage.relife,null,1)})}showResultUI(){st.instance.hidePage(t.UIPage.playing,()=>{st.instance.showPage(t.UIPage.result),st.instance.showPage(t.UIPage.info,null,!0,!0,!1,!0)})}}ft.instance=null;class wt extends it{constructor(){super(),this.type=Z.PANEL,this._time=5,wt.instance=this}onAwake(){this._relife=this.owner,this._uiBox=this._relife.getChildAt(0),this._relifeBtn=this._uiBox.getChildByName("RelifeBtn"),this._restartBtn=this._uiBox.getChildByName("AgainBtn"),this._shareBtn=this._uiBox.getChildByName("ShareBtn"),this._title=this._uiBox.getChildByName("Title"),this._timerImg=this._uiBox.getChildByName("Timer"),this._relifeBtn.on(Laya.Event.CLICK,this,this.playerRelfie.bind(this)),this._shareBtn.on(Laya.Event.CLICK,this,this.relifeByShare.bind(this)),this._restartBtn.on(Laya.Event.CLICK,this,this.playAgain.bind(this))}onEnable(){}onDisable(){}show(t=0){switch(super.show(),t){case 0:this._relifeBtn.visible=!0,this._restartBtn.visible=!0,this._title.visible=!1,this.showCountdown();break;case 1:this._timerImg.visible=!1,this._relifeBtn.visible=!1,this._restartBtn.visible=!0,this._title.visible=!0}P.showBanner(),P.stopGameRecord()}hide(){super.hide(),P.hideBanner()}playerRelfie(){c.instance().playEffect("Click"),P.showVideoRewardAd(()=>{Laya.timer.clear(this,this._refreshCountdown),st.instance.hidePage(t.UIPage.relife,()=>{st.instance.showPage(t.UIPage.playing,()=>{e.dispatchEvent(r.PLAYER_RELIFE),P.startGameRecord()})})},()=>{P.ShowToast("只有观看完毕才可获取奖励哦~")})}relifeByShare(){c.instance().playEffect("Click"),P.share(!1,()=>{Laya.timer.clear(this,this._refreshCountdown),st.instance.hidePage(t.UIPage.relife,()=>{st.instance.showPage(t.UIPage.playing,()=>{e.dispatchEvent(r.PLAYER_RELIFE)})})},()=>{P.ShowToast("分享失败~")})}playAgain(){c.instance().playEffect("Click"),Laya.timer.clear(this,this._refreshCountdown),st.instance.hidePage(t.UIPage.relife,()=>{S.instance.event(S.on_clear_scene),st.instance.showPage(t.UIPage.loading);let e=Math.floor(l.instance().getSceneLevel()/3)+1;e=e%7==0?1:e%7,at.instance().loadLevel(e).then(()=>{console.log("init scene complete"),st.instance.hidePage(t.UIPage.loading,()=>{st.instance.showPage(t.UIPage.home,null),st.instance.showPage(t.UIPage.info,null,!0,!0,!0)})})})}showCountdown(){this._time=5,this._timerImg.skin="textures/d5.png",this._timerImg.visible=!0,this._relifeBtn.visible=!0,Laya.timer.loop(1e3,this,this._refreshCountdown)}_refreshCountdown(){if(this._time>0&&this._time--,0===this._time)return this._timerImg.visible=!1,this._relifeBtn.visible=!1,void Laya.timer.clear(this,this._refreshCountdown);this._timerImg.skin=`textures/d${this._time}.png`}}wt.instance=null;class Lt extends Laya.Script{constructor(){super(...arguments),this._tween=new Laya.Tween}onAwake(){this._rankBack=this.owner,this._rankLabel=this._rankBack.getChildByName("RankLabel"),this._coinLabel=this._rankBack.getChildByName("Coin").getChildByName("CoinLabel"),this._nameLabel=this._rankBack.getChildByName("NameLabel")}setData(t){t&&this.refreshUI(t)}refreshUI(t){t&&(this._rankBack.scaleX=1,this._rankBack.scaleY=1,t.player?(this._rankBack.skin="textures/you.png",this.playTween(),v.rewardCoin=l.instance().getRewardCoinCount(t.rank),v.rewardScore=l.instance().getRankScore(t.rank),z.instance().addScore(v.rewardScore)):(this._rankBack.skin="textures/RankPanel.png",this.stopTween()),this._nameLabel.text=t.name,l.instance().getRewardCoinCount(t.rank)&&(this._coinLabel.text=l.instance().getRewardCoinCount(t.rank).toString()))}playTween(){this._toLong()}_toLong(){this._tween.to(this._rankBack,{scaleX:1.1,scaleY:1.1},500,null,Laya.Handler.create(this,this._toShort))}_toShort(){this._tween.to(this._rankBack,{scaleX:1,scaleY:1},500,null,Laya.Handler.create(this,this._toLong))}stopTween(){this._tween.clear()}}class It extends it{constructor(){super(),this.onShowEnd=this.setRankItem,It.instance=this}onAwake(){this._result=this.owner,this._uiBox=this._result.getChildAt(0),this._videoBtn=this._uiBox.getChildByName("VideoBtn"),this._shareBtn=this._uiBox.getChildByName("ShareBtn"),this._directBtn=this._uiBox.getChildByName("DirectBtn"),this._recordBtn=this._uiBox.getChildByName("RecordBtn"),this._recordLabel=this._recordBtn.getChildByName("RecordLabel"),this._ranks=this._uiBox.getChildByName("Ranks"),this._youRankLabel=this._uiBox.getChildByName("RankBack").getChildByName("YouRankBack"),this._videoBtn.on(Laya.Event.CLICK,this,this.getVideoReward),this._shareBtn.on(Laya.Event.CLICK,this,this.getRewardByShare),this._directBtn.on(Laya.Event.CLICK,this,this.getDirectReward),this._recordBtn.on(Laya.Event.CLICK,this,this.shareRecord)}onStart(){}show(){super.show(),this._refreshYouRankLabel(),P.showBanner(),P.stopGameRecord(),Laya.Browser.window.tt?(this._shareBtn.visible=!1,this._recordBtn.visible=!0,d.instance().canShowReward()?(this._recordLabel.text="三倍领取",this._recordBtn.centerX=-185,this._recordBtn.centerY=300,this._recordBtn.scale(1,1),this._videoBtn.visible=!1):(this._recordLabel.text="分享录屏",this._recordBtn.centerX=0,this._recordBtn.centerY=150,this._recordBtn.scale(.8,.8),this._videoBtn.visible=!0)):(this._videoBtn.visible=!0,this._shareBtn.visible=!1,this._recordBtn.visible=!1),l.instance().getSceneLevel()%3==0&&P.showInterstitialAd()}hide(){super.hide(),P.hideBanner()}shareRecord(){P.canReleaseGameRecord()&&(d.instance().canShowReward()?P.releaseGameRecord(()=>{let a=new Laya.Vector2(this._recordBtn.x,this._recordBtn.y);st.instance.showPage(t.UIPage.coinEffect,null,a,()=>{e.dispatchEvent(r.ADD_MOENY)},10,st.instance.getCoinPrefab()),this._getReward(3),this.nextLevel(),this._recordBtn.visible=!1,P.ShowToast("录屏分享成功，获得三倍奖励~")},()=>{P.ShowToast("录屏分享失败")}):P.releaseGameRecord(()=>{P.ShowToast("录屏分享成功~")},()=>{P.ShowToast("录屏分享失败")}))}getVideoReward(){c.instance().playEffect("Click"),P.showVideoRewardAd(()=>{P.ShowToast("恭喜获得三倍奖励~");let a=new Laya.Vector2(this._videoBtn.x,this._videoBtn.y);st.instance.showPage(t.UIPage.coinEffect,null,a,()=>{e.dispatchEvent(r.ADD_MOENY)},10,st.instance.getCoinPrefab()),this._getReward(3),this.nextLevel()},()=>{P.ShowToast("只有观看完毕才可获取奖励哦~")})}getDirectReward(){c.instance().playEffect("Click");let a=new Laya.Vector2(this._directBtn.x,this._directBtn.y);st.instance.showPage(t.UIPage.coinEffect,null,a,()=>{e.dispatchEvent(r.ADD_MOENY)},10,st.instance.getCoinPrefab()),this._getReward(),this.nextLevel()}nextLevel(){l.instance().nextLevel();let e=Math.floor(l.instance().getSceneLevel()/3)+1;e=e%7==0?1:e%7,st.instance.hidePage(t.UIPage.result,()=>{S.instance.event(S.on_clear_scene),st.instance.showPage(t.UIPage.loading),at.instance().loadLevel(e).then(()=>{st.instance.hidePage(t.UIPage.loading,()=>{st.instance.showPage(t.UIPage.home),st.instance.showPage(t.UIPage.info,null,!0,!0,!0)})})})}setRankItem(){for(let t=0;t<this._ranks.numChildren;t++){let e;v.playerInfos.map(a=>{a.rank-1==t&&(e=a)});const a=this._ranks.getChildAt(t).getComponent(Lt);a.setData&&a.setData(e)}}_getReward(t=1){let e=v.rewardCoin*t;z.instance().addMoney(e,!0)}_refreshYouRankLabel(){switch(v.playRank){case 1:this._youRankLabel.text="第一名";break;case 2:this._youRankLabel.text="第二名";break;case 3:this._youRankLabel.text="第三名";break;case 4:this._youRankLabel.text="第四名"}}getRewardByShare(){c.instance().playEffect("Click"),P.share(!1,()=>{P.ShowToast("分享成功，获得三倍金币奖励！！！"),this._getReward(3),this.nextLevel()},()=>{P.ShowToast("分享失败，请分享到不同的群~")})}}It.instance=null;class Pt extends it{constructor(){super(),this.type=Z.PANEL,Pt.instance=this}onAwake(){this._setting=this.owner,this._uiBox=this._setting.getChildAt(0),this._closeBtn=this._uiBox.getChildByName("CloseBtn"),this._vibrateToggle=this._uiBox.getChildByName("Vibrate").getChildByName("VibrateToggle"),this._audioToggle=this._uiBox.getChildByName("Audio").getChildByName("AudioToggle"),this._closeBtn.on(Laya.Event.CLICK,this,this.onCloseBtnClick),this._vibrateToggle.on(Laya.Event.CLICK,this,this.onVibrateToggleClick),this._audioToggle.on(Laya.Event.CLICK,this,this.onAudioToggleClick)}onStart(){}show(){super.show(),this._refreshSettingUI()}hide(){super.hide()}_refreshSettingUI(){c.instance().getVibrate()?this._vibrateToggle.skin="textures/toggle_on.png":this._vibrateToggle.skin="textures/toggle_off.png",c.instance().getAudioMute()?this._audioToggle.skin="textures/toggle_off.png":this._audioToggle.skin="textures/toggle_on.png"}onVibrateToggleClick(){c.instance().playEffect("Click"),c.instance().setVibrate(!c.instance().getVibrate()),this._refreshSettingUI()}onAudioToggleClick(){c.instance().setAudioMute(!c.instance().getAudioMute()),c.instance().playEffect("Click"),this._refreshSettingUI()}onCloseBtnClick(){c.instance().playEffect("Click"),st.instance.hidePage(t.UIPage.setting,()=>{})}}Pt.instance=null;class vt extends it{constructor(){super(),vt.instance=this}onAwake(){this._shop=this.owner,this._uiBox=this._shop.getChildAt(0),this._plankList=this._uiBox.getChildByName("PlankList"),this._listBox=this._plankList.getChildAt(0),this._unLockBtn=this._uiBox.getChildByName("CoinUnlockBtn"),this._priceLabel=this._unLockBtn.getChildByName("CoinCount"),this._adBtn=this._uiBox.getChildByName("AdBtn"),this._homeBtn=this._uiBox.getChildByName("HomeBtn"),this.show(),this._unLockBtn.on(Laya.Event.CLICK,this,this.randomUnlcok),this._adBtn.on(Laya.Event.CLICK,this,this.addMoneyByAD),this._homeBtn.on(Laya.Event.CLICK,this,this.showHomeView),e.register(r.SHOP_PLANK_BUY,this._refeshUI,this),e.register(r.SHOP_PLANK_CHOOSE,this._refeshUI,this)}onStart(){}show(){this._shop&&(this._listBox.numChildren>0?this._refeshUI():P.hideBanner())}_refeshUI(){let t=D.getPlanksRecord(),e=0;for(let a in t){this._listBox.getChildAt(e).getChildAt(0).getComponent(gt).setData(a),e++}H.instance().isAllUnlock()?this._unLockBtn.visible=!1:(this._unLockBtn.visible=!0,this._priceLabel.text=(1500*H.instance().getUnlockCount()).toString())}randomUnlcok(){H.instance().unlockPlankByMoney()}showHomeView(){c.instance().playEffect("Click"),st.instance.hidePage(t.UIPage.shop,()=>{st.instance.showPage(t.UIPage.home)})}addMoneyByAD(){c.instance().playEffect("Click");let a=new Laya.Vector2(this._adBtn.x,this._adBtn.y);P.showVideoRewardAd(()=>{z.instance().addMoney(1500,!0),P.ShowToast("恭喜获得1500金币~"),st.instance.showPage(t.UIPage.coinEffect,null,a,()=>{e.dispatchEvent(r.ADD_MOENY)},10,st.instance.getCoinPrefab())},()=>{P.ShowToast("只有观看完毕才可获取奖励哦~")})}}vt.instance=null;class St{constructor(){}static init(){var t=Laya.ClassUtils.regClass;t("script/Pages/GamePage.ts",st),t("script/Pages/LoadingPage.ts",lt),t("Util/CoinFlyEffect.ts",ut),t("script/UI/Home.ts",pt),t("script/UI/Compoments/MoneyInfo.ts",mt),t("script/UI/Info.ts",ct),t("script/UI/Loading.ts",_t),t("script/UI/Compoments/PlankShopItem.ts",gt),t("script/UI/Playing.ts",ft),t("script/UI/Relife.ts",wt),t("script/UI/Compoments/RankItem.ts",Lt),t("script/UI/Result.ts",It),t("script/UI/Setting.ts",Pt),t("script/UI/Shop.ts",vt)}}St.width=750,St.height=1334,St.scaleMode="fixedwidth",St.screenMode="none",St.alignV="top",St.alignH="center",St.startScene="Scenes/Start.scene",St.sceneRoot="",St.debug=!1,St.stat=!1,St.physicsDebug=!1,St.exportSceneToJson=!0,St.init();class Ct{static Sin(t){return Math.sin(t)}static Cos(t){return Math.cos(t)}static Tan(t){return Math.tan(t)}static Asin(t){return Math.asin(t)}static Acos(t){return Math.acos(t)}static Atan(t){return Math.atan(t)}static Atan2(t,e){return Math.atan2(t,e)}static Sqrt(t){return Math.sqrt(t)}static Abs(t){return Math.abs(t)}static Random(t,e,a=!0){return a?Math.random()*(e-t)+t:Math.floor(Math.random()*(e-t)+t)}static Min(...t){let e=t.length;if(0==e)return 0;let a=t[0];for(let i=1;i<e;i++)t[i]<a&&(a=t[i]);return a}static Max(...t){let e=t.length;if(0==e)return 0;let a=t[0];for(let i=1;i<e;i++)t[i]>a&&(a=t[i]);return a}static Pow(t,e){return Math.pow(t,e)}static Exp(t){return Math.exp(t)}static Log(t){return Math.log(t)}static Log10(t){return Math.log10(t)}static Ceil(t){return Math.ceil(t)}static Floor(t){return Math.floor(t)}static Round(t,e=0){let a=this.Pow(10,e);return Math.floor(t*a+.5)/a}static RoundVector3(t,e=0){t.x=this.Round(t.x,e),t.y=this.Round(t.y,e),t.z=this.Round(t.z,e)}static Sign(t){return t<0?-1:1}static Clamp(t,e,a){return t<e?t=e:(t>a&&(t=a),t)}static Clamp01(t){return t<0?0:t>1?1:t}static Lerp(t,e,a){return t+(e-t)*this.Clamp01(a)}static LerpUnclamped(t,e,a){return t+(e-t)*a}static LerpAngle(t,e,a){let i=this.Repeat(e-t,360);return i>180&&(i-=360),t+i*this.Clamp01(a)}static MoveTowards(t,e,a){return this.Abs(e-t)<=a?e:t+this.Sign(e-t)*a}static MoveTowardsAngle(t,e,a){let i=this.DeltaAngle(t,e);return-a<i&&i<a?e:(e=t+i,this.MoveTowards(t,e,a))}static SmoothStep(t,e,a){return e*(a=-2*(a=this.Clamp01(a))*a*a+3*a*a)+t*(1-a)}static Gamma(t,e,a){let i=!1;t<0&&(i=!0);let s=this.Abs(t);if(s>e)return i?-s:s;let n=this.Pow(s/e,a)*e;return i?-n:n}static Repeat(t,e){return this.Clamp(t-this.Floor(t/e)*e,0,e)}static PingPong(t,e){return t=this.Repeat(t,2*e),e-this.Abs(t-e)}static InverseLerp(t,e,a){return t!=e?this.Clamp01((a-t)/(e-t)):0}static DeltaAngle(t,e){let a=this.Repeat(e-t,360);return a>180&&(a-=360),a}static SmoothDamp(t,e,a,i,s=Number.MAX_SAFE_INTEGER,n=.001*Laya.timer.delta){let r=2/(i=this.Max(1e-4,i)),o=r*n,h=1/(1+o+.48*o*o+.235*o*o*o),l=t-e,c=e,d=s*i,y=(a+r*(l=this.Clamp(l,-d,d)))*n;a=(a-r*y)*h;let u=(e=t-l)+(l+y)*h;return c-t>0==u>c&&(a=((u=c)-c)/n),{value:u,currentVelocity:a}}static LineIntersection(t,e,a,i,s){let n=e.x-t.x,r=e.y-t.y,o=i.x-a.x,h=i.y-a.y,l=n*h-r*o;if(0==l)return!1;let c=((a.x-t.x)*h-(a.y-t.y)*o)/l;return new Laya.Vector2(t.x+c*n,t.y+c*r),!0}static LineSegmentIntersection(t,e,a,i,s){let n=e.x-t.x,r=e.y-t.y,o=i.x-a.x,h=i.y-a.y,l=n*h-r*o;if(0==l)return!1;let c=a.x-t.x,d=a.y-t.y,y=(c*h-d*o)/l;if(y<0||y>1)return!1;let u=(c*r-d*n)/l;return!(u<0||u>1)&&(new Laya.Vector2(t.x+y*n,t.y+y*r),!0)}}Ct.PI=3.141593,Ct.Infinity=Number.MAX_SAFE_INTEGER,Ct.NegativeInfinity=Number.MIN_SAFE_INTEGER,Ct.Deg2Rad=.01745329,Ct.Rad2Deg=57.29578;var At=Laya.Quaternion,xt=(At.prototype.vmult=function(t,e){e=e||new Laya.Vector3;var a=t.x,i=t.y,s=t.z,n=this.x,r=this.y,o=this.z,h=this.w,l=h*a+r*s-o*i,c=h*i+o*a-n*s,d=h*s+n*i-r*a,y=-n*a-r*i-o*s;return e.x=l*h+y*-n+c*-o-d*-r,e.y=c*h+y*-r+d*-n-l*-o,e.z=d*h+y*-o+l*-r-c*-n,e},At.prototype.conjugate=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},At.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},At.prototype.setFromEuler=function(t){var e=t.x,a=t.y,i=t.z,s=Math.cos,n=Math.sin,r=s(e/2),o=s(a/2),h=s(i/2),l=n(e/2),c=n(a/2),d=n(i/2);return this.x=l*o*h+r*c*d,this.y=r*c*h-l*o*d,this.z=r*o*d+l*c*h,this.w=r*o*h-l*c*d,this},At.prototype.setFromAxisAngle=function(t,e){var a=e/2,i=Math.sin(a);return this.x=t.x*i,this.y=t.y*i,this.z=t.z*i,this.w=Math.cos(a),this},At.prototype.setFromRotationMatrix=function(t){var e,a=t.elements,i=a[0],s=a[4],n=a[8],r=a[1],o=a[5],h=a[9],l=a[2],c=a[6],d=a[10],y=i+o+d;return y>0?(e=.5/Math.sqrt(y+1),this.w=.25/e,this.x=(c-h)*e,this.y=(n-l)*e,this.z=(r-s)*e):i>o&&i>d?(e=2*Math.sqrt(1+i-o-d),this.w=(c-h)/e,this.x=.25*e,this.y=(s+r)/e,this.z=(n+l)/e):o>d?(e=2*Math.sqrt(1+o-i-d),this.w=(n-l)/e,this.x=(s+r)/e,this.y=.25*e,this.z=(h+c)/e):(e=2*Math.sqrt(1+d-i-o),this.w=(r-s)/e,this.x=(n+l)/e,this.y=(h+c)/e,this.z=.25*e),this},At.prototype.setFromUnitVectors=function(t,e){var a=t.dot(e)+1;return a<1e-6?(a=0,Math.abs(t.x)>Math.abs(t.z)?(this.x=-t.y,this.y=t.x,this.z=0,this.w=a):(this.x=0,this.y=-t.z,this.z=t.y,this.w=a)):(this.x=t.y*e.z-t.z*e.y,this.y=t.z*e.x-t.x*e.z,this.z=t.x*e.y-t.y*e.x,this.w=a),this.normalize()},At.prototype.angleTo=function(t){return 2*Math.acos(Math.abs(Ct.Clamp(this.dot(t),-1,1)))},At.prototype.rotateTowards=function(t,e){var a=this.angleTo(t);if(0===a)return this;var i=Math.min(1,e/a);return this.slerp(t,i),this},At.prototype.inverse=function(){return this.conjugate()},At.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},At.prototype.lengthSq=function(){return this.dot(this)},At.prototype.length=function(){return Math.sqrt(this.dot(this))},At.prototype.normalize=function(){var t=this.length();return 0===t?(this.x=0,this.y=0,this.z=0,this.w=1):(t=1/t,this.x=this.x*t,this.y=this.y*t,this.z=this.z*t,this.w=this.w*t),this},At.prototype.multiply=function(t){return this.multiplyQuaternions(this,t)},At.prototype.premultiply=function(t){return this.multiplyQuaternions(t,this)},At.prototype.multiplyQuaternions=function(t,e){var a=t.x,i=t.y,s=t.z,n=t.w,r=e.x,o=e.y,h=e.z,l=e.w;return this.x=a*l+n*r+i*h-s*o,this.y=i*l+n*o+s*r-a*h,this.z=s*l+n*h+a*o-i*r,this.w=n*l-a*r-i*o-s*h,this},At.prototype.slerp=function(t,e){if(0===e)return this;if(1===e)return this.copy(t);var a=this.x,i=this.y,s=this.z,n=this.w,r=n*t.w+a*t.x+i*t.y+s*t.z;if(r<0?(this.w=-t.w,this.x=-t.x,this.y=-t.y,this.z=-t.z,r=-r):this.copy(t),r>=1)return this.w=n,this.x=a,this.y=i,this.z=s,this;var o=1-r*r;if(o<=Number.EPSILON){var h=1-e;return this.w=h*n+e*this.w,this.x=h*a+e*this.x,this.y=h*i+e*this.y,this.z=h*s+e*this.z,this.normalize(),this}var l=Math.sqrt(o),c=Math.atan2(l,r),d=Math.sin((1-e)*c)/l,y=Math.sin(e*c)/l;return this.w=n*d+this.w*y,this.x=a*d+this.x*y,this.y=i*d+this.y*y,this.z=s*d+this.z*y,this},At.prototype.equals=function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},At.prototype.fromArray=function(t){return this.x=t[0],this.y=t[1],this.z=t[2],this.w=t[3],this},At.prototype.toArray=function(){return[this.x,this.y,this.z,this.w]},At.prototype.toString=function(){return"Quaternion: "+this.x+", "+this.y+", "+this.z+", "+this.w},function(){Laya.Vector3.prototype.vsub=function(t,e){e=e||new Laya.Vector3;return Laya.Vector3.subtract(this,t,e),e},Laya.Vector3.prototype.vadd=function(t,e){e=e||new Laya.Vector3;return Laya.Vector3.add(this,t,e),e},Laya.Vector3.prototype.mult=function(t,e){e=e||new Laya.Vector3;var a=this.x,i=this.y,s=this.z;return e.x=t*a,e.y=t*i,e.z=t*s,e},Laya.Vector3.prototype.divide=function(t,e){e=e||new Laya.Vector3;var a=this.x,i=this.y,s=this.z;return e.x=a/t,e.y=i/t,e.z=s/t,e},Laya.Vector3.prototype.cross=function(t,e){var a=t.x,i=t.y,s=t.z,n=this.x,r=this.y,o=this.z;return(e=e||new Laya.Vector3).x=r*s-o*i,e.y=o*a-n*s,e.z=n*i-r*a,e},Laya.Vector3.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},Laya.Vector3.prototype.normalize=function(){var t=this.magnitude();return t<=1e-5?this.set(0,0,0):this.divide(t,this),this},Laya.Vector3.prototype.magnitude=function(){return Ct.Sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},Laya.Vector3.prototype.magnitudeSquared=function(){return this.dot(this)},Laya.Vector3.prototype.distanceTo=function(t){var e=this.x,a=this.y,i=this.z,s=t.x,n=t.y,r=t.z;return Math.sqrt((s-e)*(s-e)+(n-a)*(n-a)+(r-i)*(r-i))},Laya.Vector3.prototype.distanceSquared=function(t){var e=this.x,a=this.y,i=this.z,s=t.x,n=t.y,r=t.z;return(s-e)*(s-e)+(n-a)*(n-a)+(r-i)*(r-i)},Laya.Vector3.prototype.scale=Laya.Vector3.prototype.mult,Laya.Vector3.prototype.vmul=function(t,e){return(e=e||new Laya.Vector3).x=t.x*this.x,e.y=t.y*this.y,e.z=t.z*this.z,e},Laya.Vector3.prototype.negate=function(t){return(t=t||new Laya.Vector3).x=-this.x,t.y=-this.y,t.z=-this.z,t},Laya.Vector3.prototype.set=function(t,e,a){return this.x=t,this.y=e,this.z=a,this},Laya.Vector3.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},Laya.Vector3.prototype.toArray=function(){return[this.x,this.y,this.z]},Laya.Vector3.prototype.fromArray=function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this};var t=new Laya.Vector3,e=new Laya.Vector3;Laya.Vector3.prototype.tangents=function(a,i){var s=this.norm();if(s>0){var n=t,r=1/s;n.set(this.x*r,this.y*r,this.z*r);var o=e;Math.abs(n.x)<.9?(o.set(1,0,0),n.cross(o,a)):(o.set(0,1,0),n.cross(o,a)),n.cross(a,i)}else a.set(1,0,0),i.set(0,1,0)},Laya.Vector3.prototype.lerp=function(t,e,a){var i=this.x,s=this.y,n=this.z;a.x=i+(t.x-i)*e,a.y=s+(t.y-s)*e,a.z=n+(t.z-n)*e},Laya.Vector3.prototype.almostEquals=function(t,e){return void 0===e&&(e=1e-6),!(Math.abs(this.x-t.x)>e||Math.abs(this.y-t.y)>e||Math.abs(this.z-t.z)>e)},Laya.Vector3.prototype.isZero=function(){return 0===this.x&&0===this.y&&0===this.z};var a=new Laya.Vector3;Laya.Vector3.prototype.isAntiparallelTo=function(t,e){return this.negate(a),a.almostEquals(t,e)},Laya.Vector3.angle=function(t,e){var a=Ct.Sqrt(t.magnitudeSquared()*e.magnitudeSquared());return a>=1e-15?57.29578*Ct.Acos(Ct.Clamp(t.dot(e)/a,-1,1)):0},Laya.Vector3.signedAngle=function(t,e,a){return Laya.Vector3.angle(t,e)*Ct.Sign(a.dot(t.cross(e)))},Laya.Vector3.moveTowards=function(t,e,a,i){i=i||new Laya.Vector3;var s=e.vsub(t),n=s.magnitude();return n<=a||0==n?i.copy(e):t.vadd(s.divide(n).mult(a),i),i},Laya.Vector3.reflect=function(t,e,a){a=a||new Laya.Vector3;return e.mult(-2*e.dot(t),a),a.vadd(t,a),a},Laya.Vector3.prototype.min=function(t){return this.x=Ct.Min(this.x,t.x),this.y=Ct.Min(this.y,t.y),this.z=Ct.Min(this.z,t.z),this},Laya.Vector3.prototype.max=function(t){return this.x=Ct.Max(this.x,t.x),this.y=Ct.Max(this.y,t.y),this.z=Ct.Max(this.z,t.z),this},Laya.Vector3.prototype.applyMatrix3=function(t){var e=this.x,a=this.y,i=this.z,s=t.elements;return this.x=s[0]*e+s[3]*a+s[6]*i,this.y=s[1]*e+s[4]*a+s[7]*i,this.z=s[2]*e+s[5]*a+s[8]*i,this},Laya.Vector3.prototype.applyMatrix4=function(t){var e=this.x,a=this.y,i=this.z,s=t.elements,n=1/(s[3]*e+s[7]*a+s[11]*i+s[15]);return this.x=(s[0]*e+s[4]*a+s[8]*i+s[12])*n,this.y=(s[1]*e+s[5]*a+s[9]*i+s[13])*n,this.z=(s[2]*e+s[6]*a+s[10]*i+s[14])*n,this},Laya.Vector3.prototype.applyQuaternion=function(t){var e=this.x,a=this.y,i=this.z,s=t.x,n=t.y,r=t.z,o=t.w,h=o*e+n*i-r*a,l=o*a+r*e-s*i,c=o*i+s*a-n*e,d=-s*e-n*a-r*i;return this.x=h*o+d*-s+l*-r-c*-n,this.y=l*o+d*-n+c*-s-h*-r,this.z=c*o+d*-r+h*-n-l*-s,this},Laya.Vector3.prototype.setFromMatrixPosition=function(t){var e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this},Laya.Vector3.prototype.setFromMatrixScale=function(t){var e=this.setFromMatrixColumn(t,0).magnitude(),a=this.setFromMatrixColumn(t,1).magnitude(),i=this.setFromMatrixColumn(t,2).magnitude();return this.x=e,this.y=a,this.z=i,this},Laya.Vector3.prototype.setFromMatrix3Column=function(t,e){return this.fromArray(t.elements,3*e)},Laya.Vector3.prototype.setFromMatrixColumn=function(t,e){return this.fromArray(t.elements,4*e)},Laya.Vector3.prototype.toString=function(){return"Vector3: "+this.x+", "+this.y+", "+this.z},Laya.Vector3.zero=new Laya.Vector3,Laya.Vector3.one=new Laya.Vector3(1,1,1),Laya.Vector3.up=new Laya.Vector3(0,1,0),Laya.Vector3.down=new Laya.Vector3(0,-1,0),Laya.Vector3.forward=new Laya.Vector3(0,0,1),Laya.Vector3.back=new Laya.Vector3(0,0,-1),Laya.Vector3.right=new Laya.Vector3(-1,0,0),Laya.Vector3.left=new Laya.Vector3(1,0,0)}(),Laya.Vector2);new xt,xt.prototype.vsub=function(t,e){return(e=e||new Laya.Vector2).x=this.x-t.x,e.y=this.y-t.y,e},xt.prototype.vadd=function(t,e){return(e=e||new Laya.Vector2).x=this.x+t.x,e.y=this.y+t.y,e},xt.prototype.mult=function(t,e){return(e=e||new xt).x=this.x*t,e.y=this.y*t,e},xt.prototype.divide=function(t,e){return(e=e||new xt).x=this.x/t,e.y=this.y/t,e},xt.prototype.dot=function(t){return this.x*t.x+this.y*t.y},xt.prototype.lerp=function(t,e,a){return e=Ct.Clamp01(e),(a=a||new Laya.Vector2).x=this.x+(t.x-this.x)*e,a.y=this.y+(t.y-this.y)*e,a},xt.prototype.lerpUnclamped=function(t,e,a){return(a=a||new Laya.Vector2).x=this.x+(t.x-this.x)*e,a.y=this.y+(t.y-this.y)*e,a},xt.prototype.magnitude=function(){return Ct.Sqrt(this.x*this.x+this.y*this.y)},xt.moveTowards=function(t,e,a,i){i=i||new xt;var s=e.vsub(t),n=s.magnitude();return n<=a||0==n?i.copy(e):t.vadd(s.divide(n).mult(a),i),i},xt.prototype.normalize=function(){let t=this.magnitude();return t<=1e-5?this.set(0,0):this.divide(t,this),this},xt.prototype.magnitudeSquared=function(){return this.dot(this)},xt.prototype.unit=xt.prototype.normalize,xt.prototype.distanceTo=function(t){var e=this.x,a=this.y,i=t.x,s=t.y;return Math.sqrt((i-e)*(i-e)+(s-a)*(s-a))},xt.prototype.distanceSquared=function(t){var e=this.x,a=this.y,i=t.x,s=t.y;return(i-e)*(i-e)+(s-a)*(s-a)},xt.prototype.negate=function(t){return(t=t||new Laya.Vector2).x=-this.x,t.y=-this.y,t},xt.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this},xt.prototype.set=function(t,e){this.x=t,this.y=e},xt.prototype.toArray=function(){return[this.x,this.y]},xt.prototype.fromArray=function(t){return this.x=t[0],this.y=t[1],this.z=t[2],this},xt.prototype.almostEquals=function(t,e){return void 0===e&&(e=1e-6),!(Math.abs(this.x-t.x)>e||Math.abs(this.y-t.y)>e)},xt.prototype.isZero=function(){return 0===this.x&&0===this.y},xt.prototype.min=function(t){return this.x=Ct.Min(this.x,t.x),this.y=Ct.Min(this.y,t.y),this},xt.prototype.max=function(t){return this.x=Ct.Max(this.x,t.x),this.y=Ct.Max(this.y,t.y),this},xt.angle=function(t,e){var a=Ct.Sqrt(t.magnitudeSquared()*e.magnitudeSquared());return a>=1e-15?57.29578*Ct.Acos(Ct.Clamp(t.dot(e)/a,-1,1)):0},xt.signedAngle=function(t,e){return xt.angle(t,e)*Ct.Sign(t.x*e.y-t.y*e.x)},xt.reflect=function(t,e,a){return a=a||new xt,e.mult(-2*e.dot(t),a),a.vadd(t,a),a},xt.prototype.toString=function(){return"Vector2: "+this.x+", "+this.y},xt.zero=new xt,xt.one=new xt(1,1),xt.up=new xt(0,1),xt.down=new xt(0,-1),xt.right=new xt(1,0),xt.left=new xt(-1,0);Laya.Node.prototype.find=function(t){if(!t)return this;let e=t.split("/"),a=this;for(;e.length>0;)if(!(a=a.getChildByName(e.shift())))return null;return a},Laya.Node.prototype.findChild=function(t){let e=this;for(let a=0;a<e.numChildren;a++){let i=e.getChildAt(a);if(i.name===t)return i;if(i.numChildren>0){let e=i.findChild(t);if(e.name===t)return e}}},Laya.Node.prototype.traverse=function(t){let e=new Laya.Handler(Laya.Node.prototype,t);!function traverse(t,e){if(e.runWith(t),t.numChildren>0)for(let a=0;a<t.numChildren;a++)traverse(t.getChildAt(a),e)}(this,e),e.recover()},bt=new Laya.Quaternion,Laya.Transform3D.pointToLocalFrame=function(t,e,a,i){return i=i||new Laya.Vector3,a.vsub(t,i),e.conjugate(bt),bt.vmult(i,i),i},Laya.Transform3D.prototype.pointToLocalFrame=function(t,e){return Laya.Transform3D.pointToLocalFrame(this.position,this.rotation,t,e)},Laya.Transform3D.pointToWorldFrame=function(t,e,a,i){return i=i||new Laya.Vector3,e.vmult(a,i),i.vadd(t,i),i},Laya.Transform3D.prototype.pointToWorldFrame=function(t,e){return Laya.Transform3D.pointToWorldFrame(this.position,this.rotation,t,e)},Laya.Transform3D.vectorToWorldFrame=function(t,e,a){return a=a||new Laya.Vector3,t.vmult(e,a),a},Laya.Transform3D.prototype.vectorToWorldFrame=function(t,e){return Laya.Transform3D.vectorToWorldFrame(this.rotation,t,e)},Laya.Transform3D.vectorToLocalFrame=function(t,e,a){return a=a||new Laya.Vector3,t.w*=-1,t.vmult(e,a),t.w*=-1,a},Laya.Transform3D.prototype.vectorToLocalFrame=function(t,e){return Laya.Transform3D.vectorToLocalFrame(this.rotation,t,e)},Laya.Graphics.prototype.drawCircleWithAngle=function(t,e,a,i,s,n,r,o,h,l){let c=this,d=s+=n;if((i+=n)>s&&(s=i,i=d),!(s-i<1)){var y=[];for(let t=i;t<=s;t+=1){let e=t*Ct.Deg2Rad;y.push(Ct.Sin(e)*a,Ct.Cos(e)*a)}r||y.reverse(),o?(s-i<360&&y.push(t,e),c.drawPoly(t,e,y,o,h,l)):c.drawLines(t,e,y,h,l)}};var bt,kt=Laya.Vector3,Rt=Laya.Vector4,Tt=(Laya.Color.prototype.toVector3=function(t){return(t=t||new kt).x=this.r,t.y=this.g,t.z=this.b,t},Laya.Color.prototype.toVector4=function(t){return(t=t||new Rt).x=this.r,t.y=this.g,t.z=this.b,t.w=this.a,t},Array.prototype.unique=function(){this.sort();for(var t=[this[0]],e=1;e<this.length;e++)this[e]!==t[t.length-1]&&t.push(this[e]);return t},Array.prototype.union=function(t){return this.concat(t).unique()},Array.prototype.minus=function(t){for(var e=[],a=0;a<this.length;a++){for(var i=!0,s=0;s<t.length;s++)this[a]==t[s]&&(i=!1);i&&e.push(this[a])}return e.unique()},Array.prototype.intersect=function(t){for(var e=[],a=0;a<t.length;a++)for(var i=t[a],s=0;s<this.length;s++)if(i===this[s]){e.push(i);break}return e.unique()},Laya.Matrix4x4),Et=Laya.Vector3;!function(){var t=new Et,e=new Laya.Matrix4x4,a=new Et(0,0,0),i=new Et(1,1,1),s=new Et,n=new Et,r=new Et;Tt.prototype.set=function(t,e,a,i,s,n,r,o,h,l,c,d,y,u,p,m){var _=this.elements;return _[0]=t,_[4]=e,_[8]=a,_[12]=i,_[1]=s,_[5]=n,_[9]=r,_[13]=o,_[2]=h,_[6]=l,_[10]=c,_[14]=d,_[3]=y,_[7]=u,_[11]=p,_[15]=m,this},Tt.prototype.copy=function(t){var e=this.elements,a=t.elements;return e[0]=a[0],e[1]=a[1],e[2]=a[2],e[3]=a[3],e[4]=a[4],e[5]=a[5],e[6]=a[6],e[7]=a[7],e[8]=a[8],e[9]=a[9],e[10]=a[10],e[11]=a[11],e[12]=a[12],e[13]=a[13],e[14]=a[14],e[15]=a[15],this},Tt.prototype.copyPosition=function(t){var e=this.elements,a=t.elements;return e[12]=a[12],e[13]=a[13],e[14]=a[14],this},Tt.prototype.extractBasis=function(t,e,a){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),a.setFromMatrixColumn(this,2),this},Tt.prototype.makeBasis=function(t,e,a){return this.set(t.x,e.x,a.x,0,t.y,e.y,a.y,0,t.z,e.z,a.z,0,0,0,0,1),this},Tt.prototype.extractRotation=function(e){var a=this.elements,i=e.elements,s=1/t.setFromMatrixColumn(e,0).magnitude(),n=1/t.setFromMatrixColumn(e,1).magnitude(),r=1/t.setFromMatrixColumn(e,2).magnitude();return a[0]=i[0]*s,a[1]=i[1]*s,a[2]=i[2]*s,a[3]=0,a[4]=i[4]*n,a[5]=i[5]*n,a[6]=i[6]*n,a[7]=0,a[8]=i[8]*r,a[9]=i[9]*r,a[10]=i[10]*r,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,this},Tt.prototype.makeRotationFromEuler=function(t){var e=this.elements,a=t.x,i=t.y,s=t.z,n=Math.cos(a),r=Math.sin(a),o=Math.cos(i),h=Math.sin(i),l=Math.cos(s),c=Math.sin(s),d=n*l,y=n*c,u=r*l,p=r*c;return e[0]=o*l,e[4]=-o*c,e[8]=h,e[1]=y+u*h,e[5]=d-p*h,e[9]=-r*o,e[2]=p-d*h,e[6]=u+y*h,e[10]=n*o,e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},Tt.prototype.makeRotationFromQuaternion=function(t){return this.compose(a,t,i)},Tt.prototype.lookAt=function(t,e,a){var i=this.elements;return t.vsub(e,r),0===r.magnitudeSquared()&&(r.z=1),r.normalize(),a.cross(r,s),0===s.magnitudeSquared()&&(1===Math.abs(a.z)?r.x+=1e-4:r.z+=1e-4,r.normalize(),a.cross(r,s)),s.normalize(),r.cross(s,n),i[0]=s.x,i[4]=n.x,i[8]=r.x,i[1]=s.y,i[5]=n.y,i[9]=r.y,i[2]=s.z,i[6]=n.z,i[10]=r.z,this},Tt.prototype.multiply=function(t){return this.multiplyMatrices(this,t)},Tt.prototype.premultiply=function(t){return this.multiplyMatrices(t,this)},Tt.prototype.multiplyMatrices=function(t,e){var a=t.elements,i=e.elements,s=this.elements,n=a[0],r=a[4],o=a[8],h=a[12],l=a[1],c=a[5],d=a[9],y=a[13],u=a[2],p=a[6],m=a[10],_=a[14],g=a[3],f=a[7],w=a[11],L=a[15],I=i[0],P=i[4],v=i[8],S=i[12],C=i[1],A=i[5],x=i[9],b=i[13],k=i[2],R=i[6],T=i[10],E=i[14],M=i[3],B=i[7],D=i[11],N=i[15];return s[0]=n*I+r*C+o*k+h*M,s[4]=n*P+r*A+o*R+h*B,s[8]=n*v+r*x+o*T+h*D,s[12]=n*S+r*b+o*E+h*N,s[1]=l*I+c*C+d*k+y*M,s[5]=l*P+c*A+d*R+y*B,s[9]=l*v+c*x+d*T+y*D,s[13]=l*S+c*b+d*E+y*N,s[2]=u*I+p*C+m*k+_*M,s[6]=u*P+p*A+m*R+_*B,s[10]=u*v+p*x+m*T+_*D,s[14]=u*S+p*b+m*E+_*N,s[3]=g*I+f*C+w*k+L*M,s[7]=g*P+f*A+w*R+L*B,s[11]=g*v+f*x+w*T+L*D,s[15]=g*S+f*b+w*E+L*N,this},Tt.prototype.multiplyScalar=function(t){var e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this},Tt.prototype.determinant=function(){var t=this.elements,e=t[0],a=t[4],i=t[8],s=t[12],n=t[1],r=t[5],o=t[9],h=t[13],l=t[2],c=t[6],d=t[10],y=t[14];return t[3]*(+s*o*c-i*h*c-s*r*d+a*h*d+i*r*y-a*o*y)+t[7]*(+e*o*y-e*h*d+s*n*d-i*n*y+i*h*l-s*o*l)+t[11]*(+e*h*c-e*r*y-s*n*c+a*n*y+s*r*l-a*h*l)+t[15]*(-i*r*l-e*o*c+e*r*d+i*n*c-a*n*d+a*o*l)},Tt.prototype.transpose=function(){var t,e=this.elements;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},Tt.prototype.setPosition=function(t,e,a){var i=this.elements;return t instanceof Laya.Vector3?(i[12]=t.x,i[13]=t.y,i[14]=t.z):(i[12]=t,i[13]=e,i[14]=a),this},Tt.prototype.getInverse=function(t){var e=this.elements,a=t.elements,i=a[0],s=a[1],n=a[2],r=a[3],o=a[4],h=a[5],l=a[6],c=a[7],d=a[8],y=a[9],u=a[10],p=a[11],m=a[12],_=a[13],g=a[14],f=a[15],w=y*g*c-_*u*c+_*l*p-h*g*p-y*l*f+h*u*f,L=m*u*c-d*g*c-m*l*p+o*g*p+d*l*f-o*u*f,I=d*_*c-m*y*c+m*h*p-o*_*p-d*h*f+o*y*f,P=m*y*l-d*_*l-m*h*u+o*_*u+d*h*g-o*y*g,v=i*w+s*L+n*I+r*P;if(0===v)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);var S=1/v;return e[0]=w*S,e[1]=(_*u*r-y*g*r-_*n*p+s*g*p+y*n*f-s*u*f)*S,e[2]=(h*g*r-_*l*r+_*n*c-s*g*c-h*n*f+s*l*f)*S,e[3]=(y*l*r-h*u*r-y*n*c+s*u*c+h*n*p-s*l*p)*S,e[4]=L*S,e[5]=(d*g*r-m*u*r+m*n*p-i*g*p-d*n*f+i*u*f)*S,e[6]=(m*l*r-o*g*r-m*n*c+i*g*c+o*n*f-i*l*f)*S,e[7]=(o*u*r-d*l*r+d*n*c-i*u*c-o*n*p+i*l*p)*S,e[8]=I*S,e[9]=(m*y*r-d*_*r-m*s*p+i*_*p+d*s*f-i*y*f)*S,e[10]=(o*_*r-m*h*r+m*s*c-i*_*c-o*s*f+i*h*f)*S,e[11]=(d*h*r-o*y*r-d*s*c+i*y*c+o*s*p-i*h*p)*S,e[12]=P*S,e[13]=(d*_*n-m*y*n+m*s*u-i*_*u-d*s*g+i*y*g)*S,e[14]=(m*h*n-o*_*n-m*s*l+i*_*l+o*s*g-i*h*g)*S,e[15]=(o*y*n-d*h*n+d*s*l-i*y*l-o*s*u+i*h*u)*S,this},Tt.prototype.scale=function(t){var e=this.elements,a=t.x,i=t.y,s=t.z;return e[0]*=a,e[4]*=i,e[8]*=s,e[1]*=a,e[5]*=i,e[9]*=s,e[2]*=a,e[6]*=i,e[10]*=s,e[3]*=a,e[7]*=i,e[11]*=s,this},Tt.prototype.getMaxScaleOnAxis=function(){var t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],a=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],i=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,a,i))},Tt.prototype.makeTranslation=function(t,e,a){return this.set(1,0,0,t,0,1,0,e,0,0,1,a,0,0,0,1),this},Tt.prototype.makeRotationX=function(t){var e=Math.cos(t),a=Math.sin(t);return this.set(1,0,0,0,0,e,-a,0,0,a,e,0,0,0,0,1),this},Tt.prototype.makeRotationY=function(t){var e=Math.cos(t),a=Math.sin(t);return this.set(e,0,a,0,0,1,0,0,-a,0,e,0,0,0,0,1),this},Tt.prototype.makeRotationZ=function(t){var e=Math.cos(t),a=Math.sin(t);return this.set(e,-a,0,0,a,e,0,0,0,0,1,0,0,0,0,1),this},Tt.prototype.makeRotationAxis=function(t,e){var a=Math.cos(e),i=Math.sin(e),s=1-a,n=t.x,r=t.y,o=t.z,h=s*n,l=s*r;return this.set(h*n+a,h*r-i*o,h*o+i*r,0,h*r+i*o,l*r+a,l*o-i*n,0,h*o-i*r,l*o+i*n,s*o*o+a,0,0,0,0,1),this},Tt.prototype.makeScale=function(t,e,a){return this.set(t,0,0,0,0,e,0,0,0,0,a,0,0,0,0,1),this},Tt.prototype.makeShear=function(t,e,a){return this.set(1,e,a,0,t,1,a,0,t,e,1,0,0,0,0,1),this},Tt.prototype.compose=function(t,e,a){var i=this.elements,s=e.x,n=e.y,r=e.z,o=e.w,h=s+s,l=n+n,c=r+r,d=s*h,y=s*l,u=s*c,p=n*l,m=n*c,_=r*c,g=o*h,f=o*l,w=o*c,L=a.x,I=a.y,P=a.z;return i[0]=(1-(p+_))*L,i[1]=(y+w)*L,i[2]=(u-f)*L,i[3]=0,i[4]=(y-w)*I,i[5]=(1-(d+_))*I,i[6]=(m+g)*I,i[7]=0,i[8]=(u+f)*P,i[9]=(m-g)*P,i[10]=(1-(d+p))*P,i[11]=0,i[12]=t.x,i[13]=t.y,i[14]=t.z,i[15]=1,this},Tt.prototype.decompose=function(a,i,s){var n=this.elements,r=t.set(n[0],n[1],n[2]).magnitude(),o=t.set(n[4],n[5],n[6]).magnitude(),h=t.set(n[8],n[9],n[10]).magnitude();this.determinant()<0&&(r=-r),a.x=n[12],a.y=n[13],a.z=n[14],e.copy(this);var l=1/r,c=1/o,d=1/h;return e.elements[0]*=l,e.elements[1]*=l,e.elements[2]*=l,e.elements[4]*=c,e.elements[5]*=c,e.elements[6]*=c,e.elements[8]*=d,e.elements[9]*=d,e.elements[10]*=d,i.setFromRotationMatrix(e),s.x=r,s.y=o,s.z=h,this},Tt.prototype.equals=function(t){for(var e=this.elements,a=t.elements,i=0;i<16;i++)if(e[i]!==a[i])return!1;return!0},Tt.prototype.toArray=function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var a=this.elements;return t[e]=a[0],t[e+1]=a[1],t[e+2]=a[2],t[e+3]=a[3],t[e+4]=a[4],t[e+5]=a[5],t[e+6]=a[6],t[e+7]=a[7],t[e+8]=a[8],t[e+9]=a[9],t[e+10]=a[10],t[e+11]=a[11],t[e+12]=a[12],t[e+13]=a[13],t[e+14]=a[14],t[e+15]=a[15],t},Tt.prototype.fromArray=function(t,e){void 0===e&&(e=0);for(var a=0;a<16;a++)this.elements[a]=t[a+e];return this}}();new class{constructor(){window.Laya3D?Laya3D.init(St.width,St.height):Laya.init(St.width,St.height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=St.scaleMode,Laya.stage.screenMode=St.screenMode,Laya.stage.alignV=St.alignV,Laya.stage.alignH=St.alignH,Laya.URL.exportSceneToJson=St.exportSceneToJson,(St.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),St.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),St.stat&&Laya.Stat.show(),Laya.alertGlobalError(!0),Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION)}onVersionLoaded(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))}onConfigLoaded(){St.startScene&&Laya.Scene.open(St.startScene)}}}();